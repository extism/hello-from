var Te=Object.create;var Lt=Object.defineProperty;var Ce=Object.getOwnPropertyDescriptor;var Fe=Object.getOwnPropertyNames;var He=Object.getPrototypeOf,Ye=Object.prototype.hasOwnProperty;var ke=(r,t,e)=>t in r?Lt(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var Pt=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var Ke=(r,t,e,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Fe(t))!Ye.call(r,n)&&n!==e&&Lt(r,n,{get:()=>t[n],enumerable:!(s=Ce(t,n))||s.enumerable});return r};var ze=(r,t,e)=>(e=r!=null?Te(He(r)):{},Ke(t||!r||!r.__esModule?Lt(e,"default",{value:r,enumerable:!0}):e,r));var it=(r,t,e)=>(ke(r,typeof t!="symbol"?t+"":t,e),e),wt=(r,t,e)=>{if(!t.has(r))throw TypeError("Cannot "+e)};var h=(r,t,e)=>(wt(r,t,"read from private field"),e?e.call(r):t.get(r)),W=(r,t,e)=>{if(t.has(r))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(r):t.set(r,e)},R=(r,t,e,s)=>(wt(r,t,"write to private field"),s?s.call(r,e):t.set(r,e),e);var z=(r,t,e)=>(wt(r,t,"access private method"),e);var le=Pt((Pn,oe)=>{"use strict";oe.exports=ie;function ie(r,t,e){r instanceof RegExp&&(r=ne(r,e)),t instanceof RegExp&&(t=ne(t,e));var s=re(r,t,e);return s&&{start:s[0],end:s[1],pre:e.slice(0,s[0]),body:e.slice(s[0]+r.length,s[1]),post:e.slice(s[1]+t.length)}}function ne(r,t){var e=t.match(r);return e?e[0]:null}ie.range=re;function re(r,t,e){var s,n,i,o,l,a=e.indexOf(r),c=e.indexOf(t,a+1),d=a;if(a>=0&&c>0){if(r===t)return[a,c];for(s=[],i=e.length;d>=0&&!l;)d==a?(s.push(d),a=e.indexOf(r,d+1)):s.length==1?l=[s.pop(),c]:(n=s.pop(),n<i&&(i=n,o=c),c=e.indexOf(t,d+1)),d=a<c&&a>=0?a:c;s.length&&(l=[i,o])}return l}});var pe=Pt((vn,fe)=>{var ae=le();fe.exports=$e;var ce="\0SLASH"+Math.random()+"\0",de="\0OPEN"+Math.random()+"\0",kt="\0CLOSE"+Math.random()+"\0",ue="\0COMMA"+Math.random()+"\0",he="\0PERIOD"+Math.random()+"\0";function Yt(r){return parseInt(r,10)==r?parseInt(r,10):r.charCodeAt(0)}function Qe(r){return r.split("\\\\").join(ce).split("\\{").join(de).split("\\}").join(kt).split("\\,").join(ue).split("\\.").join(he)}function je(r){return r.split(ce).join("\\").split(de).join("{").split(kt).join("}").split(ue).join(",").split(he).join(".")}function me(r){if(!r)return[""];var t=[],e=ae("{","}",r);if(!e)return r.split(",");var s=e.pre,n=e.body,i=e.post,o=s.split(",");o[o.length-1]+="{"+n+"}";var l=me(i);return i.length&&(o[o.length-1]+=l.shift(),o.push.apply(o,l)),t.push.apply(t,o),t}function $e(r){return r?(r.substr(0,2)==="{}"&&(r="\\{\\}"+r.substr(2)),ut(Qe(r),!0).map(je)):[]}function qe(r){return"{"+r+"}"}function ts(r){return/^-?0\d/.test(r)}function es(r,t){return r<=t}function ss(r,t){return r>=t}function ut(r,t){var e=[],s=ae("{","}",r);if(!s)return[r];var n=s.pre,i=s.post.length?ut(s.post,!1):[""];if(/\$$/.test(s.pre))for(var o=0;o<i.length;o++){var l=n+"{"+s.body+"}"+i[o];e.push(l)}else{var a=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(s.body),c=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(s.body),d=a||c,m=s.body.indexOf(",")>=0;if(!d&&!m)return s.post.match(/,.*\}/)?(r=s.pre+"{"+s.body+kt+s.post,ut(r)):[r];var u;if(d)u=s.body.split(/\.\./);else if(u=me(s.body),u.length===1&&(u=ut(u[0],!1).map(qe),u.length===1))return i.map(function(Ee){return s.pre+u[0]+Ee});var p;if(d){var b=Yt(u[0]),f=Yt(u[1]),g=Math.max(u[0].length,u[1].length),G=u.length==3?Math.abs(Yt(u[2])):1,w=es,C=f<b;C&&(G*=-1,w=ss);var k=u.some(ts);p=[];for(var K=b;w(K,f);K+=G){var N;if(c)N=String.fromCharCode(K),N==="\\"&&(N="");else if(N=String(K),k){var Jt=g-N.length;if(Jt>0){var At=new Array(Jt+1).join("0");K<0?N="-"+At+N.slice(1):N=At+N}}p.push(N)}}else{p=[];for(var D=0;D<u.length;D++)p.push.apply(p,ut(u[D],!1))}for(var D=0;D<p.length;D++)for(var o=0;o<i.length;o++){var l=n+p[D]+i[o];(!t||d||l)&&e.push(l)}}return e}});var M={allowSharedBufferCodec:!1,manifestSupportsPaths:!1,crossOriginChecksEnforced:!0,fsAccess:!1,hasWorkerCapability:typeof window<"u"?window.crossOriginIsolated&&typeof SharedArrayBuffer<"u":!0,supportsWasiPreview1:!0};async function vt(r){throw new Error("readFile not supported in this environment")}async function St(r,t){if(String(r.headers.get("Content-Type")).split(";")[0]==="application/octet-stream"){let n=new Headers(r.headers);n.set("Content-Type","application/wasm"),r=new Response(r.body,{status:r.status,statusText:r.statusText,headers:n})}let e=t?await r.clone().arrayBuffer():void 0;return{module:await WebAssembly.compileStreaming(r),data:e}}async function Nt(r,t){if(r instanceof ArrayBuffer)return{wasm:[{data:new Uint8Array(r)}]};if(r instanceof WebAssembly.Module)return{wasm:[{module:r}]};if(typeof r=="string"){if(r.search(/^\s*\{/g)===0)return JSON.parse(r);if(r.search(/^(https?|file):\/\//)!==0)return{wasm:[{path:r}]};r=new URL(r)}if(r instanceof Response||r?.constructor?.name==="Response"){let s=r,n=s.headers.get("content-type")||"application/octet-stream";switch(n.split(";")[0]){case"application/octet-stream":case"application/wasm":return{wasm:[{response:s}]};case"application/json":case"text/json":return Nt(JSON.parse(await s.text()),t);default:throw new TypeError(`While processing manifest URL "${s.url}"; expected content-type of "text/json", "application/json", "application/octet-stream", or "application/wasm"; got "${n}" after stripping off charset.`)}}if(r instanceof URL)return Nt(await t(r,{redirect:"follow"}),t);if(!("wasm"in r))throw new TypeError('Expected "wasm" key in manifest');if(!Array.isArray(r.wasm))throw new TypeError('Expected "manifest.wasm" to be array');let e=r.wasm.findIndex(s=>!("data"in s)&&!("url"in s)&&!("path"in s)&&!("module"in s)&&!("response"in s));if(e>-1)throw new TypeError(`Expected every item in "manifest.wasm" to include either a "data", "url", or "path" key; got bad item at index ${e}`);return{...r}}async function Me(r,t=fetch){let e=await Nt(r,t);return e.config??={},e}async function Ut(r,t){let e=[],s=await Me(r,t),n=await Promise.all(s.wasm.map(async(i,o)=>{let l,a;if(i.data){let c=i.data;a=c.buffer?c.buffer:c,l=await WebAssembly.compile(c)}else if(i.path){let c=i.path,d=await vt(c);a=d.buffer,l=await WebAssembly.compile(d)}else if(i.url){let c=await t(i.url,{headers:{accept:"application/wasm;q=0.9,application/octet-stream;q=0.8","user-agent":"extism"}}),d=await St(c,Boolean(i.hash));a=d.data,l=d.module}else if(i.response){let c=await St(i.response,Boolean(i.hash));a=c.data,l=c.module}else if(i.module)e[o]=i.name??String(o),l=i.module;else throw new Error(`Unrecognized wasm item at index ${o}. Keys include: "${Object.keys(i).sort().join(",")}"`);if(i.hash){if(!a)throw new Error("Item specified a hash but WebAssembly.Module source data is unavailable for hashing");let c=new Uint8Array(await crypto.subtle.digest("SHA-256",a)),d=new Uint8Array(32),m=!0;for(let p=0;p<32;++p)d[p]=parseInt(i.hash.slice(p<<1,(p<<1)+2),16),m=m&&d[p]===c[p];let u=()=>[...c].map(p=>p.toString(16).padStart(2,"0")).join("");if(!m)throw new Error(`Plugin error: hash mismatch. Expected: ${i.hash}. Actual: ${u()}`);i.name??=u()}return e[o]=i.name??String(o),l}));return[e,n]}var bt,rt,_t=class extends DataView{constructor(e){super(e);W(this,rt,null)}json(){return JSON.parse(this.string())}arrayBuffer(){return this.buffer}string(){return h(_t,bt).decode(this.buffer)}bytes(){return h(this,rt)??R(this,rt,new Uint8Array(this.buffer)),h(this,rt)}setInt8(e,s){throw new Error("Cannot set values on output")}setInt16(e,s,n){throw new Error("Cannot set values on output")}setInt32(e,s,n){throw new Error("Cannot set values on output")}setUint8(e,s){throw new Error("Cannot set values on output")}setUint16(e,s,n){throw new Error("Cannot set values on output")}setUint32(e,s,n){throw new Error("Cannot set values on output")}setFloat32(e,s,n){throw new Error("Cannot set values on output")}setFloat64(e,s,n){throw new Error("Cannot set values on output")}setBigInt64(e,s,n){throw new Error("Cannot set values on output")}setBigUint64(e,s,n){throw new Error("Cannot set values on output")}},F=_t;bt=new WeakMap,rt=new WeakMap,W(F,bt,new TextDecoder);var Et=Symbol("begin"),Zt=Symbol("end"),Tt=Symbol("env"),ot=Symbol("get-block"),yt=Symbol("import-state"),Gt=Symbol("export-state"),Q=Symbol("store-value"),lt=Symbol("reset"),Z=class{buffer;view;local;get byteLength(){return this.buffer.byteLength}constructor(t,e){this.buffer=t,this.view=new DataView(this.buffer),this.local=e}static indexToAddress(t){return BigInt(t)<<48n}static addressToIndex(t){return Number(BigInt(t)>>48n)}static maskAddress(t){return Number(BigInt(t)&(1n<<48n)-1n)}},tt=class{#e;#t=[];#s;#n;#l;#i;#o;#r=new Map;constructor(t,e,s){this.#i=t,this.#s=e,this.#n=new TextDecoder,this.#l=new TextEncoder,this.#e=[],this.alloc(1),this.#o=s}alloc(t){let e=new Z(new this.#i(Number(t)),!0),s=this.#t.length;return this.#t.push(e),Z.indexToAddress(s)}getVariable(t){return this.#r.has(t)?this.read(this.#r.get(t)):null}setVariable(t,e){let s=this[Q](e);if(s===null)return 0n;let n=this.#r.get(t)??null;return n!==null&&(this.#t[n]=this.#t[s],this.#t[s]=null,s===this.#t.length-1&&this.#t.pop()),this.#r.set(t,n??s),Z.indexToAddress(n??s)}read(t){let e=Z.addressToIndex(t),s=this.#t[e];if(!s)return null;let n=!(s.buffer instanceof ArrayBuffer)&&!M.allowSharedBufferCodec?new Uint8Array(s.buffer).slice().buffer:s.buffer;return new F(n)}store(t){let e=this[Q](t);if(!e)throw new Error("failed to store output");return Z.indexToAddress(e)}[Tt]={alloc:t=>this.alloc(t),free:t=>{this.#t[Z.addressToIndex(t)]=null},load_u8:t=>{let e=Z.addressToIndex(t),s=Z.maskAddress(t);return this.#t[e]?.view.getUint8(Number(s))},load_u64:t=>{let e=Z.addressToIndex(t),s=Z.maskAddress(t);return this.#t[e]?.view.getBigUint64(Number(s),!0)},store_u8:(t,e)=>{let s=Z.addressToIndex(t),n=Z.maskAddress(t);this.#t[s]?.view.setUint8(Number(n),Number(e))},store_u64:(t,e)=>{let s=Z.addressToIndex(t),n=Z.maskAddress(t);this.#t[s]?.view.setBigUint64(Number(n),e,!0)},input_length:()=>BigInt(this.#a?.byteLength??0),input_load_u8:t=>{let e=Z.maskAddress(t);return this.#a?.view.getUint8(Number(e))},input_load_u64:t=>{let e=Z.maskAddress(t);return this.#a?.view.getBigUint64(Number(e),!0)},output_set:(t,e)=>{let s=Z.addressToIndex(t),n=this.#t[s];if(!n)throw new Error(`cannot assign to this block (addr=${t.toString(16).padStart(16,"0")}; length=${e})`);if(e>n.buffer.byteLength)throw new Error("length longer than target block");this.#e[this.#e.length-1][1]=s},error_set:t=>{let e=Z.addressToIndex(t);if(!this.#t[e])throw new Error("cannot assign to this block");this.#e[this.#e.length-1][2]=e},config_get:t=>{let e=this.read(t);if(e===null)return 0n;let s=e.string();return s in this.#o?this.store(this.#o[s]):0n},var_get:t=>{let e=this.read(t);if(e===null)return 0n;let s=e.string();return this.#r.has(s)?Z.indexToAddress(this.#r.get(s)):0n},var_set:(t,e)=>{let s=this.read(t);if(s===null)return 0n;let n=s.string();if(e===0n)return this.#r.delete(n),0n;this.#r.set(n,Z.addressToIndex(e))},http_request:(t,e)=>(this.#s.error("http_request is not enabled"),0n),http_status_code:()=>(this.#s.error("http_status_code is not enabled"),0),length:t=>{let e=Z.addressToIndex(t),s=this.#t[e];return s?BigInt(s.buffer.byteLength):0n},log_warn:t=>{let e=Z.addressToIndex(t),s=this.#t[e];if(!s)return this.#s.error(`failed to log(warn): bad block reference in addr 0x${t.toString(16).padStart(64,"0")}`);let n=this.#n.decode(s.buffer);this.#s.warn(n)},log_info:t=>{let e=Z.addressToIndex(t),s=this.#t[e];if(!s)return this.#s.error(`failed to log(info): bad block reference in addr 0x${t.toString(16).padStart(64,"0")}`);let n=this.#n.decode(s.buffer);this.#s.info(n)},log_debug:t=>{let e=Z.addressToIndex(t),s=this.#t[e];if(!s)return this.#s.error(`failed to log(debug): bad block reference in addr 0x${t.toString(16).padStart(64,"0")}`);let n=this.#n.decode(s.buffer);this.#s.debug(n)},log_error:t=>{let e=Z.addressToIndex(t),s=this.#t[e];if(!s)return this.#s.error(`failed to log(error): bad block reference in addr 0x${t.toString(16).padStart(64,"0")}`);let n=this.#n.decode(s.buffer);this.#s.error(n)}};get#a(){let t=this.#e[this.#e.length-1][0];return t===null?null:this.#t[t]}[lt](){this.#t.length=1,this.#e.length=0}[ot](t){let e=this.#t[t];if(!e)throw new Error(`invalid block index: ${t}`);return e}[yt](t,e=!1){for(let[s,n]of t.blocks){if(s&&e){let i=new Uint8Array(new this.#i(Number(s.byteLength)));i.set(new Uint8Array(s)),s=i.buffer}this.#t[n]=s?new Z(s,!1):null}this.#e=t.stack}[Gt](){return{stack:this.#e.slice(),blocks:this.#t.map((t,e)=>t?t.local?(t.local=!1,[t.buffer,e]):null:[null,e]).filter(Boolean)}}[Q](t){if(!t)return null;if(typeof t=="string"&&(t=this.#l.encode(t)),t instanceof Uint8Array){if(t.buffer.constructor===this.#i){let i=this.#t.length;return this.#t.push(new Z(t.buffer,!0)),i}let e=Z.addressToIndex(this.alloc(t.length)),s=this.#t[e];return new Uint8Array(s.buffer).set(t,0),e}return t}[Et](t){this.#e.push([t,null,null])}[Zt](){let[,t,e]=this.#e.pop(),s=e===null?1:0,n=e??t,i=[null,null];return n===null||this.#t[n]===null||(i[s]=n),i}};var O=class{static read_bytes(t,e){let s=new O;return s.buf=t.getUint32(e,!0),s.buf_len=t.getUint32(e+4,!0),s}static read_bytes_array(t,e,s){let n=[];for(let i=0;i<s;i++)n.push(O.read_bytes(t,e+8*i));return n}},B=class{static read_bytes(t,e){let s=new B;return s.buf=t.getUint32(e,!0),s.buf_len=t.getUint32(e+4,!0),s}static read_bytes_array(t,e,s){let n=[];for(let i=0;i<s;i++)n.push(B.read_bytes(t,e+8*i));return n}},Dt=0,Qt=1,jt=2;var Rt=4;var tn=1<<0,en=1<<1,sn=1<<2,nn=1<<3,rn=1<<4,Xt=class{write_bytes(t,e){t.setUint8(e,this.fs_filetype),t.setUint16(e+2,this.fs_flags,!0),t.setBigUint64(e+8,this.fs_rights_base,!0),t.setBigUint64(e+16,this.fs_rights_inherited,!0)}constructor(t,e){this.fs_rights_base=0n,this.fs_rights_inherited=0n,this.fs_filetype=t,this.fs_flags=e}},on=1<<0,ln=1<<1,an=1<<2,cn=1<<3,Oe=1<<0,Be=1<<1,Je=1<<2,Ae=1<<3,gt=class{write_bytes(t,e){t.setBigUint64(e,this.dev,!0),t.setBigUint64(e+8,this.ino,!0),t.setUint8(e+16,this.filetype),t.setBigUint64(e+24,this.nlink,!0),t.setBigUint64(e+32,this.size,!0),t.setBigUint64(e+38,this.atim,!0),t.setBigUint64(e+46,this.mtim,!0),t.setBigUint64(e+52,this.ctim,!0)}constructor(t,e){this.dev=0n,this.ino=0n,this.nlink=0n,this.atim=0n,this.mtim=0n,this.ctim=0n,this.filetype=t,this.size=e}};var dn=1<<0,un=1<<0;var hn=1<<0,mn=1<<1,fn=1<<0,pn=1<<0,bn=1<<1;var Ft=class{start(t){this.inst=t,t.exports._start()}initialize(t){this.inst=t,t.exports._initialize()}constructor(t,e,s){this.args=[],this.env=[],this.fds=[],this.args=t,this.env=e,this.fds=s;let n=this;this.wasiImport={args_sizes_get(i,o){let l=new DataView(n.inst.exports.memory.buffer);l.setUint32(i,n.args.length,!0);let a=0;for(let c of n.args)a+=c.length+1;return l.setUint32(o,a,!0),0},args_get(i,o){let l=new DataView(n.inst.exports.memory.buffer),a=new Uint8Array(n.inst.exports.memory.buffer),c=o;for(let d=0;d<n.args.length;d++){l.setUint32(i,o,!0),i+=4;let m=new TextEncoder("utf-8").encode(n.args[d]);a.set(m,o),l.setUint8(o+m.length,0),o+=m.length+1}return 0},environ_sizes_get(i,o){let l=new DataView(n.inst.exports.memory.buffer);l.setUint32(i,n.env.length,!0);let a=0;for(let c of n.env)a+=c.length+1;return l.setUint32(o,a,!0),0},environ_get(i,o){let l=new DataView(n.inst.exports.memory.buffer),a=new Uint8Array(n.inst.exports.memory.buffer),c=o;for(let d=0;d<e.length;d++){l.setUint32(i,o,!0),i+=4;let m=new TextEncoder("utf-8").encode(e[d]);a.set(m,o),l.setUint8(o+m.length,0),o+=m.length+1}return 0},clock_res_get(i,o){throw"unimplemented"},clock_time_get(i,o,l){let a=new DataView(n.inst.exports.memory.buffer);if(i===0)a.setBigUint64(l,BigInt(new Date().getTime())*1000000n,!0);else if(i==1){let c;try{c=BigInt(Math.round(performance.now()*1e6))}catch{c=0n}a.setBigUint64(l,c,!0)}else a.setBigUint64(l,0n,!0);return 0},fd_advise(i,o,l,a){return n.fds[i]!=null?n.fds[i].fd_advise(o,l,a):8},fd_allocate(i,o,l){return n.fds[i]!=null?n.fds[i].fd_allocate(o,l):8},fd_close(i){if(n.fds[i]!=null){let o=n.fds[i].fd_close();return n.fds[i]=void 0,o}else return 8},fd_datasync(i){return n.fds[i]!=null?n.fds[i].fd_datasync():8},fd_fdstat_get(i,o){if(n.fds[i]!=null){let{ret:l,fdstat:a}=n.fds[i].fd_fdstat_get();return a?.write_bytes(new DataView(n.inst.exports.memory.buffer),o),l}else return 8},fd_fdstat_set_flags(i,o){return n.fds[i]!=null?n.fds[i].fd_fdstat_set_flags(o):8},fd_fdstat_set_rights(i,o,l){return n.fds[i]!=null?n.fds[i].fd_fdstat_set_rights(o,l):8},fd_filestat_get(i,o){if(n.fds[i]!=null){let{ret:l,filestat:a}=n.fds[i].fd_filestat_get();return a?.write_bytes(new DataView(n.inst.exports.memory.buffer),o),l}else return 8},fd_filestat_set_size(i,o){return n.fds[i]!=null?n.fds[i].fd_filestat_set_size(o):8},fd_filestat_set_times(i,o,l,a){return n.fds[i]!=null?n.fds[i].fd_filestat_set_times(o,l,a):8},fd_pread(i,o,l,a,c){let d=new DataView(n.inst.exports.memory.buffer),m=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[i]!=null){let u=O.read_bytes_array(d,o,l),{ret:p,nread:b}=n.fds[i].fd_pread(m,u,a);return d.setUint32(c,b,!0),p}else return 8},fd_prestat_get(i,o){let l=new DataView(n.inst.exports.memory.buffer);if(n.fds[i]!=null){let{ret:a,prestat:c}=n.fds[i].fd_prestat_get();return c?.write_bytes(l,o),a}else return 8},fd_prestat_dir_name(i,o,l){if(n.fds[i]!=null){let{ret:a,prestat_dir_name:c}=n.fds[i].fd_prestat_dir_name();return c!=null&&new Uint8Array(n.inst.exports.memory.buffer).set(c,o),a}else return 8},fd_pwrite(i,o,l,a,c){let d=new DataView(n.inst.exports.memory.buffer),m=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[i]!=null){let u=B.read_bytes_array(d,o,l),{ret:p,nwritten:b}=n.fds[i].fd_pwrite(m,u,a);return d.setUint32(c,b,!0),p}else return 8},fd_read(i,o,l,a){let c=new DataView(n.inst.exports.memory.buffer),d=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[i]!=null){let m=O.read_bytes_array(c,o,l),{ret:u,nread:p}=n.fds[i].fd_read(d,m);return c.setUint32(a,p,!0),u}else return 8},fd_readdir(i,o,l,a,c){let d=new DataView(n.inst.exports.memory.buffer),m=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[i]!=null){let u=0;for(;;){let{ret:p,dirent:b}=n.fds[i].fd_readdir_single(a);if(p!=0)return d.setUint32(c,u,!0),p;if(b==null)break;if(l-u<b.head_length()){u=l;break}let f=new ArrayBuffer(b.head_length());if(b.write_head_bytes(new DataView(f),0),m.set(new Uint8Array(f).slice(0,Math.min(f.byteLength,l-u)),o),o+=b.head_length(),u+=b.head_length(),l-u<b.name_length()){u=l;break}b.write_name_bytes(m,o,l-u),o+=b.name_length(),u+=b.name_length(),a=b.d_next}return d.setUint32(c,u,!0),0}else return 8},fd_renumber(i,o){if(n.fds[i]!=null&&n.fds[o]!=null){let l=n.fds[o].fd_close();return l!=0?l:(n.fds[o]=n.fds[i],n.fds[i]=void 0,0)}else return 8},fd_seek(i,o,l,a){let c=new DataView(n.inst.exports.memory.buffer);if(n.fds[i]!=null){let{ret:d,offset:m}=n.fds[i].fd_seek(o,l);return c.setBigInt64(a,m,!0),d}else return 8},fd_sync(i){return n.fds[i]!=null?n.fds[i].fd_sync():8},fd_tell(i,o){let l=new DataView(n.inst.exports.memory.buffer);if(n.fds[i]!=null){let{ret:a,offset:c}=n.fds[i].fd_tell();return l.setBigUint64(o,c,!0),a}else return 8},fd_write(i,o,l,a){let c=new DataView(n.inst.exports.memory.buffer),d=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[i]!=null){let m=B.read_bytes_array(c,o,l),{ret:u,nwritten:p}=n.fds[i].fd_write(d,m);return c.setUint32(a,p,!0),u}else return 8},path_create_directory(i,o,l){let a=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[i]!=null){let c=new TextDecoder("utf-8").decode(a.slice(o,o+l));return n.fds[i].path_create_directory(c)}},path_filestat_get(i,o,l,a,c){let d=new DataView(n.inst.exports.memory.buffer),m=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[i]!=null){let u=new TextDecoder("utf-8").decode(m.slice(l,l+a)),{ret:p,filestat:b}=n.fds[i].path_filestat_get(o,u);return b?.write_bytes(d,c),p}else return 8},path_filestat_set_times(i,o,l,a,c,d,m){let u=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[i]!=null){let p=new TextDecoder("utf-8").decode(u.slice(l,l+a));return n.fds[i].path_filestat_set_times(o,p,c,d,m)}else return 8},path_link(i,o,l,a,c,d,m){let u=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[i]!=null&&n.fds[c]!=null){let p=new TextDecoder("utf-8").decode(u.slice(l,l+a)),b=new TextDecoder("utf-8").decode(u.slice(d,d+m));return n.fds[c].path_link(i,o,p,b)}else return 8},path_open(i,o,l,a,c,d,m,u,p){let b=new DataView(n.inst.exports.memory.buffer),f=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[i]!=null){let g=new TextDecoder("utf-8").decode(f.slice(l,l+a)),{ret:G,fd_obj:w}=n.fds[i].path_open(o,g,c,d,m,u);if(G!=0)return G;n.fds.push(w);let C=n.fds.length-1;return b.setUint32(p,C,!0),0}else return 8},path_readlink(i,o,l,a,c,d){let m=new DataView(n.inst.exports.memory.buffer),u=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[i]!=null){let p=new TextDecoder("utf-8").decode(u.slice(o,o+l)),{ret:b,data:f}=n.fds[i].path_readlink(p);if(f!=null){if(f.length>c)return m.setUint32(d,0,!0),8;u.set(f,a),m.setUint32(d,f.length,!0)}return b}else return 8},path_remove_directory(i,o,l){let a=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[i]!=null){let c=new TextDecoder("utf-8").decode(a.slice(o,o+l));return n.fds[i].path_remove_directory(c)}else return 8},path_rename(i,o,l,a,c,d){throw"FIXME what is the best abstraction for this?"},path_symlink(i,o,l,a,c){let d=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[l]!=null){let m=new TextDecoder("utf-8").decode(d.slice(i,i+o)),u=new TextDecoder("utf-8").decode(d.slice(a,a+c));return n.fds[l].path_symlink(m,u)}else return 8},path_unlink_file(i,o,l){let a=new Uint8Array(n.inst.exports.memory.buffer);if(n.fds[i]!=null){let c=new TextDecoder("utf-8").decode(a.slice(o,o+l));return n.fds[i].path_unlink_file(c)}else return 8},poll_oneoff(i,o,l){throw"async io not supported"},proc_exit(i){throw"exit with exit code "+i},proc_raise(i){throw"raised signal "+i},sched_yield(){},random_get(i,o){let l=new Uint8Array(n.inst.exports.memory.buffer);for(let a=0;a<o;a++)l[i+a]=Math.random()*256|0},sock_recv(i,o,l){throw"sockets not supported"},sock_send(i,o,l){throw"sockets not supported"},sock_shutdown(i,o){throw"sockets not supported"}}}};var at=class{fd_advise(t,e,s){return-1}fd_allocate(t,e){return-1}fd_close(){return 0}fd_datasync(){return-1}fd_fdstat_get(){return{ret:-1,fdstat:null}}fd_fdstat_set_flags(t){return-1}fd_fdstat_set_rights(t,e){return-1}fd_filestat_get(){return{ret:-1,filestat:null}}fd_filestat_set_size(t){return-1}fd_filestat_set_times(t,e,s){return-1}fd_pread(t,e,s){return{ret:-1,nread:0}}fd_prestat_get(){return{ret:-1,prestat:null}}fd_prestat_dir_name(t,e){return{ret:-1,prestat_dir_name:null}}fd_pwrite(t,e,s){return{ret:-1,nwritten:0}}fd_read(t,e){return{ret:-1,nread:0}}fd_readdir_single(t){return{ret:-1,dirent:null}}fd_seek(t,e){return{ret:-1,offset:0n}}fd_sync(){return 0}fd_tell(){return{ret:-1,offset:0n}}fd_write(t,e){return{ret:-1,nwritten:0}}path_create_directory(t){return-1}path_filestat_get(t,e){return{ret:-1,filestat:null}}path_filestat_set_times(t,e,s,n,i){return-1}path_link(t,e,s,n){return-1}path_open(t,e,s,n,i,o){return{ret:-1,fd_obj:null}}path_readlink(t){return{ret:-1,data:null}}path_remove_directory(t){return-1}path_rename(t,e,s){return-1}path_symlink(t,e){return-1}path_unlink_file(t){return-1}};var J=class{get size(){return BigInt(this.data.byteLength)}stat(){return new gt(Rt,this.size)}truncate(){this.data=new Uint8Array([])}constructor(t){this.data=new Uint8Array(t)}};var j=class extends at{fd_fdstat_get(){return{ret:0,fdstat:new Xt(Rt,0)}}fd_read(t,e){let s=0;for(let n of e)if(this.file_pos<this.file.data.byteLength){let i=this.file.data.slice(Number(this.file_pos),Number(this.file_pos+BigInt(n.buf_len)));t.set(i,n.buf),this.file_pos+=BigInt(i.length),s+=i.length}else break;return{ret:0,nread:s}}fd_seek(t,e){let s;switch(e){case Dt:s=t;break;case Qt:s=this.file_pos+t;break;case jt:s=BigInt(this.file.data.byteLength)+t;break;default:return{ret:28,offset:0n}}return s<0?{ret:28,offset:0n}:(this.file_pos=s,{ret:0,offset:this.file_pos})}fd_write(t,e){let s=0;for(let n of e){let i=t.slice(n.buf,n.buf+n.buf_len);if(this.file_pos+BigInt(i.byteLength)>this.file.size){let o=this.file.data;this.file.data=new Uint8Array(Number(this.file_pos+BigInt(i.byteLength))),this.file.data.set(o)}this.file.data.set(i.slice(0,Number(this.file.size-this.file_pos)),Number(this.file_pos)),this.file_pos+=BigInt(i.byteLength),s+=n.buf_len}return{ret:0,nwritten:s}}fd_filestat_get(){return{ret:0,filestat:this.file.stat()}}constructor(t){super(),this.file_pos=0n,this.file=t}};async function qt(r){let t=[],e=[],s=[new j(new J([])),new j(new J([])),new j(new J([]))],n=new Ft(t,e,s);return{async importObject(){return n.wasiImport},async initialize(i){let o=i.exports.memory;if(!o)throw new Error("The module has to export a default memory.");if(i.exports._initialize){let l=i.exports._initialize;n.initialize?n.initialize({exports:{memory:o,_initialize:()=>{l()}}}):l()}else i.exports._start&&n.start({exports:{memory:o,_start:()=>{}}})}}}var ct="extism:host/env",Ht=class{#e;#t;#s;#n=!1;constructor(t,e,s){this.#e=t,this.#s=e,this.#t=s}async reset(){return this.isActive()?!1:(this.#e[lt](),!0)}isActive(){return this.#n}async functionExists(t){try{let e=[].concat(t),[s,n]=e.length===2?[this.lookupTarget(e[0]),e[1]]:[this.#t.find(o=>WebAssembly.Module.exports(o.module).find(a=>a.name===e[0]&&a.kind==="function")),e[0]];return!(!s||!s.instance.exports[n])}catch{return!1}}async callBlock(t,e){this.#n=!0;let s=[].concat(t),[n,i]=s.length===2?[this.lookupTarget(s[0]),s[1]]:[this.#t.find(l=>WebAssembly.Module.exports(l.module).find(c=>c.name===s[0]&&c.kind==="function")),s[0]];if(!n)throw Error(`Plugin error: target "${s.join('" "')}" does not exist`);let o=n.instance.exports[i];if(!o)throw Error(`Plugin error: function "${s.join('" "')}" does not exist`);this.#e[Et](e??null);try{return o(),this.#e[Zt]()}catch(l){throw this.#e[Zt](),l}finally{this.#n=!1}}async call(t,e){let s=this.#e[Q](e),[n,i]=await this.callBlock(t,s),o=n!==null,l=n??i;if(l===null)return null;let a=this.#e[ot](l);if(!a)return null;let c=new F(a.buffer);if(o)throw new Error(`Plugin-originated error: ${c.string()}`);return c}lookupTarget(t){let e=String(t??"0"),s=this.#s.findIndex(n=>n===e);if(s===-1)throw new Error(`no module named "${t}"`);return this.#t[s]}async getExports(t){return WebAssembly.Module.exports(this.lookupTarget(t).module)||[]}async getImports(t){return WebAssembly.Module.imports(this.lookupTarget(t).module)||[]}async getInstance(t){return this.lookupTarget(t).instance}async close(){}};async function te(r,t,e,s=new tt(ArrayBuffer,r.logger,r.config)){let n=r.wasiEnabled?await qt(r.allowedPaths):null,i={...n?{wasi_snapshot_preview1:await n.importObject()}:{},[ct]:s[Tt],env:{}};for(let l in r.functions){i[l]=i[l]||{};for(let a in r.functions[l])i[l][a]=r.functions[l][a].bind(null,s)}let o=await Promise.all(e.map(async l=>{let a=await WebAssembly.instantiate(l,i);n&&await n?.initialize(a);let c=a.exports.hs_init?"haskell":a.exports._initialize?"reactor":a.exports._start?"command":"none";return(a.exports.hs_init?a.exports.hs_init:()=>{})(),{module:l,instance:a,guestType:c}}));return new Ht(s,t,o)}var ee=new URL("data:text/javascript;base64,dmFyIGZ0PU9iamVjdC5kZWZpbmVQcm9wZXJ0eTt2YXIgdXQ9KHUsdCxyKT0+dCBpbiB1P2Z0KHUsdCx7ZW51bWVyYWJsZTohMCxjb25maWd1cmFibGU6ITAsd3JpdGFibGU6ITAsdmFsdWU6cn0pOnVbdF09cjt2YXIgRz0odSx0LHIpPT4odXQodSx0eXBlb2YgdCE9InN5bWJvbCI/dCsiIjp0LHIpLHIpLFE9KHUsdCxyKT0+e2lmKCF0Lmhhcyh1KSl0aHJvdyBUeXBlRXJyb3IoIkNhbm5vdCAiK3IpfTt2YXIgUz0odSx0LHIpPT4oUSh1LHQsInJlYWQgZnJvbSBwcml2YXRlIGZpZWxkIikscj9yLmNhbGwodSk6dC5nZXQodSkpLE09KHUsdCxyKT0+e2lmKHQuaGFzKHUpKXRocm93IFR5cGVFcnJvcigiQ2Fubm90IGFkZCB0aGUgc2FtZSBwcml2YXRlIG1lbWJlciBtb3JlIHRoYW4gb25jZSIpO3QgaW5zdGFuY2VvZiBXZWFrU2V0P3QuYWRkKHUpOnQuc2V0KHUscil9LFo9KHUsdCxyLHMpPT4oUSh1LHQsIndyaXRlIHRvIHByaXZhdGUgZmllbGQiKSxzP3MuY2FsbCh1LHIpOnQuc2V0KHUscikscik7dmFyIHE9e29uKHUsdCl7YWRkRXZlbnRMaXN0ZW5lcih1LHI9Pnt0KHIuZGF0YSl9KX0scG9zdE1lc3NhZ2UodSx0PVtdKXtzZWxmLnBvc3RNZXNzYWdlKHUsdCl9fTt2YXIgRCxPLEg9Y2xhc3MgZXh0ZW5kcyBEYXRhVmlld3tjb25zdHJ1Y3RvcihyKXtzdXBlcihyKTtNKHRoaXMsTyxudWxsKX1qc29uKCl7cmV0dXJuIEpTT04ucGFyc2UodGhpcy5zdHJpbmcoKSl9YXJyYXlCdWZmZXIoKXtyZXR1cm4gdGhpcy5idWZmZXJ9c3RyaW5nKCl7cmV0dXJuIFMoSCxEKS5kZWNvZGUodGhpcy5idWZmZXIpfWJ5dGVzKCl7cmV0dXJuIFModGhpcyxPKT8/Wih0aGlzLE8sbmV3IFVpbnQ4QXJyYXkodGhpcy5idWZmZXIpKSxTKHRoaXMsTyl9c2V0SW50OChyLHMpe3Rocm93IG5ldyBFcnJvcigiQ2Fubm90IHNldCB2YWx1ZXMgb24gb3V0cHV0Iil9c2V0SW50MTYocixzLGUpe3Rocm93IG5ldyBFcnJvcigiQ2Fubm90IHNldCB2YWx1ZXMgb24gb3V0cHV0Iil9c2V0SW50MzIocixzLGUpe3Rocm93IG5ldyBFcnJvcigiQ2Fubm90IHNldCB2YWx1ZXMgb24gb3V0cHV0Iil9c2V0VWludDgocixzKXt0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBzZXQgdmFsdWVzIG9uIG91dHB1dCIpfXNldFVpbnQxNihyLHMsZSl7dGhyb3cgbmV3IEVycm9yKCJDYW5ub3Qgc2V0IHZhbHVlcyBvbiBvdXRwdXQiKX1zZXRVaW50MzIocixzLGUpe3Rocm93IG5ldyBFcnJvcigiQ2Fubm90IHNldCB2YWx1ZXMgb24gb3V0cHV0Iil9c2V0RmxvYXQzMihyLHMsZSl7dGhyb3cgbmV3IEVycm9yKCJDYW5ub3Qgc2V0IHZhbHVlcyBvbiBvdXRwdXQiKX1zZXRGbG9hdDY0KHIscyxlKXt0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBzZXQgdmFsdWVzIG9uIG91dHB1dCIpfXNldEJpZ0ludDY0KHIscyxlKXt0aHJvdyBuZXcgRXJyb3IoIkNhbm5vdCBzZXQgdmFsdWVzIG9uIG91dHB1dCIpfXNldEJpZ1VpbnQ2NChyLHMsZSl7dGhyb3cgbmV3IEVycm9yKCJDYW5ub3Qgc2V0IHZhbHVlcyBvbiBvdXRwdXQiKX19LHc9SDtEPW5ldyBXZWFrTWFwLE89bmV3IFdlYWtNYXAsTSh3LEQsbmV3IFRleHREZWNvZGVyKTt2YXIgSj17YWxsb3dTaGFyZWRCdWZmZXJDb2RlYzohMSxtYW5pZmVzdFN1cHBvcnRzUGF0aHM6ITEsY3Jvc3NPcmlnaW5DaGVja3NFbmZvcmNlZDohMCxmc0FjY2VzczohMSxoYXNXb3JrZXJDYXBhYmlsaXR5OnR5cGVvZiB3aW5kb3c8InUiP3dpbmRvdy5jcm9zc09yaWdpbklzb2xhdGVkJiZ0eXBlb2YgU2hhcmVkQXJyYXlCdWZmZXI8InUiOiEwLHN1cHBvcnRzV2FzaVByZXZpZXcxOiEwfTt2YXIgdj1TeW1ib2woImJlZ2luIiksTD1TeW1ib2woImVuZCIpLFc9U3ltYm9sKCJlbnYiKSxWPVN5bWJvbCgiZ2V0LWJsb2NrIiksQz1TeW1ib2woImltcG9ydC1zdGF0ZSIpLEY9U3ltYm9sKCJleHBvcnQtc3RhdGUiKSxUPVN5bWJvbCgic3RvcmUtdmFsdWUiKSxZPVN5bWJvbCgicmVzZXQiKSxfPWNsYXNze2J1ZmZlcjt2aWV3O2xvY2FsO2dldCBieXRlTGVuZ3RoKCl7cmV0dXJuIHRoaXMuYnVmZmVyLmJ5dGVMZW5ndGh9Y29uc3RydWN0b3IodCxyKXt0aGlzLmJ1ZmZlcj10LHRoaXMudmlldz1uZXcgRGF0YVZpZXcodGhpcy5idWZmZXIpLHRoaXMubG9jYWw9cn1zdGF0aWMgaW5kZXhUb0FkZHJlc3ModCl7cmV0dXJuIEJpZ0ludCh0KTw8NDhufXN0YXRpYyBhZGRyZXNzVG9JbmRleCh0KXtyZXR1cm4gTnVtYmVyKEJpZ0ludCh0KT4+NDhuKX1zdGF0aWMgbWFza0FkZHJlc3ModCl7cmV0dXJuIE51bWJlcihCaWdJbnQodCkmKDFuPDw0OG4pLTFuKX19LEE9Y2xhc3N7I2U7I3Q9W107I3I7I247I2w7I2k7I287I3M9bmV3IE1hcDtjb25zdHJ1Y3Rvcih0LHIscyl7dGhpcy4jaT10LHRoaXMuI3I9cix0aGlzLiNuPW5ldyBUZXh0RGVjb2Rlcix0aGlzLiNsPW5ldyBUZXh0RW5jb2Rlcix0aGlzLiNlPVtdLHRoaXMuYWxsb2MoMSksdGhpcy4jbz1zfWFsbG9jKHQpe2xldCByPW5ldyBfKG5ldyB0aGlzLiNpKE51bWJlcih0KSksITApLHM9dGhpcy4jdC5sZW5ndGg7cmV0dXJuIHRoaXMuI3QucHVzaChyKSxfLmluZGV4VG9BZGRyZXNzKHMpfWdldFZhcmlhYmxlKHQpe3JldHVybiB0aGlzLiNzLmhhcyh0KT90aGlzLnJlYWQodGhpcy4jcy5nZXQodCkpOm51bGx9c2V0VmFyaWFibGUodCxyKXtsZXQgcz10aGlzW1RdKHIpO2lmKHM9PT1udWxsKXJldHVybiAwbjtsZXQgZT10aGlzLiNzLmdldCh0KT8/bnVsbDtyZXR1cm4gZSE9PW51bGwmJih0aGlzLiN0W2VdPXRoaXMuI3Rbc10sdGhpcy4jdFtzXT1udWxsLHM9PT10aGlzLiN0Lmxlbmd0aC0xJiZ0aGlzLiN0LnBvcCgpKSx0aGlzLiNzLnNldCh0LGU/P3MpLF8uaW5kZXhUb0FkZHJlc3MoZT8/cyl9cmVhZCh0KXtsZXQgcj1fLmFkZHJlc3NUb0luZGV4KHQpLHM9dGhpcy4jdFtyXTtpZighcylyZXR1cm4gbnVsbDtsZXQgZT0hKHMuYnVmZmVyIGluc3RhbmNlb2YgQXJyYXlCdWZmZXIpJiYhSi5hbGxvd1NoYXJlZEJ1ZmZlckNvZGVjP25ldyBVaW50OEFycmF5KHMuYnVmZmVyKS5zbGljZSgpLmJ1ZmZlcjpzLmJ1ZmZlcjtyZXR1cm4gbmV3IHcoZSl9c3RvcmUodCl7bGV0IHI9dGhpc1tUXSh0KTtpZighcil0aHJvdyBuZXcgRXJyb3IoImZhaWxlZCB0byBzdG9yZSBvdXRwdXQiKTtyZXR1cm4gXy5pbmRleFRvQWRkcmVzcyhyKX1bV109e2FsbG9jOnQ9PnRoaXMuYWxsb2ModCksZnJlZTp0PT57dGhpcy4jdFtfLmFkZHJlc3NUb0luZGV4KHQpXT1udWxsfSxsb2FkX3U4OnQ9PntsZXQgcj1fLmFkZHJlc3NUb0luZGV4KHQpLHM9Xy5tYXNrQWRkcmVzcyh0KTtyZXR1cm4gdGhpcy4jdFtyXT8udmlldy5nZXRVaW50OChOdW1iZXIocykpfSxsb2FkX3U2NDp0PT57bGV0IHI9Xy5hZGRyZXNzVG9JbmRleCh0KSxzPV8ubWFza0FkZHJlc3ModCk7cmV0dXJuIHRoaXMuI3Rbcl0/LnZpZXcuZ2V0QmlnVWludDY0KE51bWJlcihzKSwhMCl9LHN0b3JlX3U4Oih0LHIpPT57bGV0IHM9Xy5hZGRyZXNzVG9JbmRleCh0KSxlPV8ubWFza0FkZHJlc3ModCk7dGhpcy4jdFtzXT8udmlldy5zZXRVaW50OChOdW1iZXIoZSksTnVtYmVyKHIpKX0sc3RvcmVfdTY0Oih0LHIpPT57bGV0IHM9Xy5hZGRyZXNzVG9JbmRleCh0KSxlPV8ubWFza0FkZHJlc3ModCk7dGhpcy4jdFtzXT8udmlldy5zZXRCaWdVaW50NjQoTnVtYmVyKGUpLHIsITApfSxpbnB1dF9sZW5ndGg6KCk9PkJpZ0ludCh0aGlzLiNhPy5ieXRlTGVuZ3RoPz8wKSxpbnB1dF9sb2FkX3U4OnQ9PntsZXQgcj1fLm1hc2tBZGRyZXNzKHQpO3JldHVybiB0aGlzLiNhPy52aWV3LmdldFVpbnQ4KE51bWJlcihyKSl9LGlucHV0X2xvYWRfdTY0OnQ9PntsZXQgcj1fLm1hc2tBZGRyZXNzKHQpO3JldHVybiB0aGlzLiNhPy52aWV3LmdldEJpZ1VpbnQ2NChOdW1iZXIociksITApfSxvdXRwdXRfc2V0Oih0LHIpPT57bGV0IHM9Xy5hZGRyZXNzVG9JbmRleCh0KSxlPXRoaXMuI3Rbc107aWYoIWUpdGhyb3cgbmV3IEVycm9yKGBjYW5ub3QgYXNzaWduIHRvIHRoaXMgYmxvY2sgKGFkZHI9JHt0LnRvU3RyaW5nKDE2KS5wYWRTdGFydCgxNiwiMCIpfTsgbGVuZ3RoPSR7cn0pYCk7aWYocj5lLmJ1ZmZlci5ieXRlTGVuZ3RoKXRocm93IG5ldyBFcnJvcigibGVuZ3RoIGxvbmdlciB0aGFuIHRhcmdldCBibG9jayIpO3RoaXMuI2VbdGhpcy4jZS5sZW5ndGgtMV1bMV09c30sZXJyb3Jfc2V0OnQ9PntsZXQgcj1fLmFkZHJlc3NUb0luZGV4KHQpO2lmKCF0aGlzLiN0W3JdKXRocm93IG5ldyBFcnJvcigiY2Fubm90IGFzc2lnbiB0byB0aGlzIGJsb2NrIik7dGhpcy4jZVt0aGlzLiNlLmxlbmd0aC0xXVsyXT1yfSxjb25maWdfZ2V0OnQ9PntsZXQgcj10aGlzLnJlYWQodCk7aWYocj09PW51bGwpcmV0dXJuIDBuO2xldCBzPXIuc3RyaW5nKCk7cmV0dXJuIHMgaW4gdGhpcy4jbz90aGlzLnN0b3JlKHRoaXMuI29bc10pOjBufSx2YXJfZ2V0OnQ9PntsZXQgcj10aGlzLnJlYWQodCk7aWYocj09PW51bGwpcmV0dXJuIDBuO2xldCBzPXIuc3RyaW5nKCk7cmV0dXJuIHRoaXMuI3MuaGFzKHMpP18uaW5kZXhUb0FkZHJlc3ModGhpcy4jcy5nZXQocykpOjBufSx2YXJfc2V0Oih0LHIpPT57bGV0IHM9dGhpcy5yZWFkKHQpO2lmKHM9PT1udWxsKXJldHVybiAwbjtsZXQgZT1zLnN0cmluZygpO2lmKHI9PT0wbilyZXR1cm4gdGhpcy4jcy5kZWxldGUoZSksMG47dGhpcy4jcy5zZXQoZSxfLmFkZHJlc3NUb0luZGV4KHIpKX0saHR0cF9yZXF1ZXN0Oih0LHIpPT4odGhpcy4jci5lcnJvcigiaHR0cF9yZXF1ZXN0IGlzIG5vdCBlbmFibGVkIiksMG4pLGh0dHBfc3RhdHVzX2NvZGU6KCk9Pih0aGlzLiNyLmVycm9yKCJodHRwX3N0YXR1c19jb2RlIGlzIG5vdCBlbmFibGVkIiksMCksbGVuZ3RoOnQ9PntsZXQgcj1fLmFkZHJlc3NUb0luZGV4KHQpLHM9dGhpcy4jdFtyXTtyZXR1cm4gcz9CaWdJbnQocy5idWZmZXIuYnl0ZUxlbmd0aCk6MG59LGxvZ193YXJuOnQ9PntsZXQgcj1fLmFkZHJlc3NUb0luZGV4KHQpLHM9dGhpcy4jdFtyXTtpZighcylyZXR1cm4gdGhpcy4jci5lcnJvcihgZmFpbGVkIHRvIGxvZyh3YXJuKTogYmFkIGJsb2NrIHJlZmVyZW5jZSBpbiBhZGRyIDB4JHt0LnRvU3RyaW5nKDE2KS5wYWRTdGFydCg2NCwiMCIpfWApO2xldCBlPXRoaXMuI24uZGVjb2RlKHMuYnVmZmVyKTt0aGlzLiNyLndhcm4oZSl9LGxvZ19pbmZvOnQ9PntsZXQgcj1fLmFkZHJlc3NUb0luZGV4KHQpLHM9dGhpcy4jdFtyXTtpZighcylyZXR1cm4gdGhpcy4jci5lcnJvcihgZmFpbGVkIHRvIGxvZyhpbmZvKTogYmFkIGJsb2NrIHJlZmVyZW5jZSBpbiBhZGRyIDB4JHt0LnRvU3RyaW5nKDE2KS5wYWRTdGFydCg2NCwiMCIpfWApO2xldCBlPXRoaXMuI24uZGVjb2RlKHMuYnVmZmVyKTt0aGlzLiNyLmluZm8oZSl9LGxvZ19kZWJ1Zzp0PT57bGV0IHI9Xy5hZGRyZXNzVG9JbmRleCh0KSxzPXRoaXMuI3Rbcl07aWYoIXMpcmV0dXJuIHRoaXMuI3IuZXJyb3IoYGZhaWxlZCB0byBsb2coZGVidWcpOiBiYWQgYmxvY2sgcmVmZXJlbmNlIGluIGFkZHIgMHgke3QudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDY0LCIwIil9YCk7bGV0IGU9dGhpcy4jbi5kZWNvZGUocy5idWZmZXIpO3RoaXMuI3IuZGVidWcoZSl9LGxvZ19lcnJvcjp0PT57bGV0IHI9Xy5hZGRyZXNzVG9JbmRleCh0KSxzPXRoaXMuI3Rbcl07aWYoIXMpcmV0dXJuIHRoaXMuI3IuZXJyb3IoYGZhaWxlZCB0byBsb2coZXJyb3IpOiBiYWQgYmxvY2sgcmVmZXJlbmNlIGluIGFkZHIgMHgke3QudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDY0LCIwIil9YCk7bGV0IGU9dGhpcy4jbi5kZWNvZGUocy5idWZmZXIpO3RoaXMuI3IuZXJyb3IoZSl9fTtnZXQjYSgpe2xldCB0PXRoaXMuI2VbdGhpcy4jZS5sZW5ndGgtMV1bMF07cmV0dXJuIHQ9PT1udWxsP251bGw6dGhpcy4jdFt0XX1bWV0oKXt0aGlzLiN0Lmxlbmd0aD0xLHRoaXMuI2UubGVuZ3RoPTB9W1ZdKHQpe2xldCByPXRoaXMuI3RbdF07aWYoIXIpdGhyb3cgbmV3IEVycm9yKGBpbnZhbGlkIGJsb2NrIGluZGV4OiAke3R9YCk7cmV0dXJuIHJ9W0NdKHQscj0hMSl7Zm9yKGxldFtzLGVdb2YgdC5ibG9ja3Mpe2lmKHMmJnIpe2xldCBuPW5ldyBVaW50OEFycmF5KG5ldyB0aGlzLiNpKE51bWJlcihzLmJ5dGVMZW5ndGgpKSk7bi5zZXQobmV3IFVpbnQ4QXJyYXkocykpLHM9bi5idWZmZXJ9dGhpcy4jdFtlXT1zP25ldyBfKHMsITEpOm51bGx9dGhpcy4jZT10LnN0YWNrfVtGXSgpe3JldHVybntzdGFjazp0aGlzLiNlLnNsaWNlKCksYmxvY2tzOnRoaXMuI3QubWFwKCh0LHIpPT50P3QubG9jYWw/KHQubG9jYWw9ITEsW3QuYnVmZmVyLHJdKTpudWxsOltudWxsLHJdKS5maWx0ZXIoQm9vbGVhbil9fVtUXSh0KXtpZighdClyZXR1cm4gbnVsbDtpZih0eXBlb2YgdD09InN0cmluZyImJih0PXRoaXMuI2wuZW5jb2RlKHQpKSx0IGluc3RhbmNlb2YgVWludDhBcnJheSl7aWYodC5idWZmZXIuY29uc3RydWN0b3I9PT10aGlzLiNpKXtsZXQgbj10aGlzLiN0Lmxlbmd0aDtyZXR1cm4gdGhpcy4jdC5wdXNoKG5ldyBfKHQuYnVmZmVyLCEwKSksbn1sZXQgcj1fLmFkZHJlc3NUb0luZGV4KHRoaXMuYWxsb2ModC5sZW5ndGgpKSxzPXRoaXMuI3Rbcl07cmV0dXJuIG5ldyBVaW50OEFycmF5KHMuYnVmZmVyKS5zZXQodCwwKSxyfXJldHVybiB0fVt2XSh0KXt0aGlzLiNlLnB1c2goW3QsbnVsbCxudWxsXSl9W0xdKCl7bGV0Wyx0LHJdPXRoaXMuI2UucG9wKCkscz1yPT09bnVsbD8xOjAsZT1yPz90LG49W251bGwsbnVsbF07cmV0dXJuIGU9PT1udWxsfHx0aGlzLiN0W2VdPT09bnVsbHx8KG5bc109ZSksbn19O3ZhciB4PWNsYXNze3N0YXRpYyByZWFkX2J5dGVzKHQscil7bGV0IHM9bmV3IHg7cmV0dXJuIHMuYnVmPXQuZ2V0VWludDMyKHIsITApLHMuYnVmX2xlbj10LmdldFVpbnQzMihyKzQsITApLHN9c3RhdGljIHJlYWRfYnl0ZXNfYXJyYXkodCxyLHMpe2xldCBlPVtdO2ZvcihsZXQgbj0wO248cztuKyspZS5wdXNoKHgucmVhZF9ieXRlcyh0LHIrOCpuKSk7cmV0dXJuIGV9fSxtPWNsYXNze3N0YXRpYyByZWFkX2J5dGVzKHQscil7bGV0IHM9bmV3IG07cmV0dXJuIHMuYnVmPXQuZ2V0VWludDMyKHIsITApLHMuYnVmX2xlbj10LmdldFVpbnQzMihyKzQsITApLHN9c3RhdGljIHJlYWRfYnl0ZXNfYXJyYXkodCxyLHMpe2xldCBlPVtdO2ZvcihsZXQgbj0wO248cztuKyspZS5wdXNoKG0ucmVhZF9ieXRlcyh0LHIrOCpuKSk7cmV0dXJuIGV9fSx0dD0wLGV0PTEscnQ9Mjt2YXIgQj00O3ZhciBOdD0xPDwwLFN0PTE8PDEsRHQ9MTw8MixMdD0xPDwzLEN0PTE8PDQsaz1jbGFzc3t3cml0ZV9ieXRlcyh0LHIpe3Quc2V0VWludDgocix0aGlzLmZzX2ZpbGV0eXBlKSx0LnNldFVpbnQxNihyKzIsdGhpcy5mc19mbGFncywhMCksdC5zZXRCaWdVaW50NjQocis4LHRoaXMuZnNfcmlnaHRzX2Jhc2UsITApLHQuc2V0QmlnVWludDY0KHIrMTYsdGhpcy5mc19yaWdodHNfaW5oZXJpdGVkLCEwKX1jb25zdHJ1Y3Rvcih0LHIpe3RoaXMuZnNfcmlnaHRzX2Jhc2U9MG4sdGhpcy5mc19yaWdodHNfaW5oZXJpdGVkPTBuLHRoaXMuZnNfZmlsZXR5cGU9dCx0aGlzLmZzX2ZsYWdzPXJ9fSxGdD0xPDwwLGt0PTE8PDEsVXQ9MTw8MixCdD0xPDwzLGN0PTE8PDAsZHQ9MTw8MSxfdD0xPDwyLGh0PTE8PDMsVT1jbGFzc3t3cml0ZV9ieXRlcyh0LHIpe3Quc2V0QmlnVWludDY0KHIsdGhpcy5kZXYsITApLHQuc2V0QmlnVWludDY0KHIrOCx0aGlzLmlubywhMCksdC5zZXRVaW50OChyKzE2LHRoaXMuZmlsZXR5cGUpLHQuc2V0QmlnVWludDY0KHIrMjQsdGhpcy5ubGluaywhMCksdC5zZXRCaWdVaW50NjQociszMix0aGlzLnNpemUsITApLHQuc2V0QmlnVWludDY0KHIrMzgsdGhpcy5hdGltLCEwKSx0LnNldEJpZ1VpbnQ2NChyKzQ2LHRoaXMubXRpbSwhMCksdC5zZXRCaWdVaW50NjQocis1Mix0aGlzLmN0aW0sITApfWNvbnN0cnVjdG9yKHQscil7dGhpcy5kZXY9MG4sdGhpcy5pbm89MG4sdGhpcy5ubGluaz0wbix0aGlzLmF0aW09MG4sdGhpcy5tdGltPTBuLHRoaXMuY3RpbT0wbix0aGlzLmZpbGV0eXBlPXQsdGhpcy5zaXplPXJ9fTt2YXIgUHQ9MTw8MCxHdD0xPDwwO3ZhciBNdD0xPDwwLEh0PTE8PDEsdnQ9MTw8MCxXdD0xPDwwLFZ0PTE8PDE7dmFyIHo9Y2xhc3N7c3RhcnQodCl7dGhpcy5pbnN0PXQsdC5leHBvcnRzLl9zdGFydCgpfWluaXRpYWxpemUodCl7dGhpcy5pbnN0PXQsdC5leHBvcnRzLl9pbml0aWFsaXplKCl9Y29uc3RydWN0b3IodCxyLHMpe3RoaXMuYXJncz1bXSx0aGlzLmVudj1bXSx0aGlzLmZkcz1bXSx0aGlzLmFyZ3M9dCx0aGlzLmVudj1yLHRoaXMuZmRzPXM7bGV0IGU9dGhpczt0aGlzLndhc2lJbXBvcnQ9e2FyZ3Nfc2l6ZXNfZ2V0KG4saSl7bGV0IG89bmV3IERhdGFWaWV3KGUuaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO28uc2V0VWludDMyKG4sZS5hcmdzLmxlbmd0aCwhMCk7bGV0IGE9MDtmb3IobGV0IGwgb2YgZS5hcmdzKWErPWwubGVuZ3RoKzE7cmV0dXJuIG8uc2V0VWludDMyKGksYSwhMCksMH0sYXJnc19nZXQobixpKXtsZXQgbz1uZXcgRGF0YVZpZXcoZS5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlciksYT1uZXcgVWludDhBcnJheShlLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKSxsPWk7Zm9yKGxldCBmPTA7ZjxlLmFyZ3MubGVuZ3RoO2YrKyl7by5zZXRVaW50MzIobixpLCEwKSxuKz00O2xldCBjPW5ldyBUZXh0RW5jb2RlcigidXRmLTgiKS5lbmNvZGUoZS5hcmdzW2ZdKTthLnNldChjLGkpLG8uc2V0VWludDgoaStjLmxlbmd0aCwwKSxpKz1jLmxlbmd0aCsxfXJldHVybiAwfSxlbnZpcm9uX3NpemVzX2dldChuLGkpe2xldCBvPW5ldyBEYXRhVmlldyhlLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtvLnNldFVpbnQzMihuLGUuZW52Lmxlbmd0aCwhMCk7bGV0IGE9MDtmb3IobGV0IGwgb2YgZS5lbnYpYSs9bC5sZW5ndGgrMTtyZXR1cm4gby5zZXRVaW50MzIoaSxhLCEwKSwwfSxlbnZpcm9uX2dldChuLGkpe2xldCBvPW5ldyBEYXRhVmlldyhlLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKSxhPW5ldyBVaW50OEFycmF5KGUuaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpLGw9aTtmb3IobGV0IGY9MDtmPHIubGVuZ3RoO2YrKyl7by5zZXRVaW50MzIobixpLCEwKSxuKz00O2xldCBjPW5ldyBUZXh0RW5jb2RlcigidXRmLTgiKS5lbmNvZGUocltmXSk7YS5zZXQoYyxpKSxvLnNldFVpbnQ4KGkrYy5sZW5ndGgsMCksaSs9Yy5sZW5ndGgrMX1yZXR1cm4gMH0sY2xvY2tfcmVzX2dldChuLGkpe3Rocm93InVuaW1wbGVtZW50ZWQifSxjbG9ja190aW1lX2dldChuLGksbyl7bGV0IGE9bmV3IERhdGFWaWV3KGUuaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO2lmKG49PT0wKWEuc2V0QmlnVWludDY0KG8sQmlnSW50KG5ldyBEYXRlKCkuZ2V0VGltZSgpKSoxMDAwMDAwbiwhMCk7ZWxzZSBpZihuPT0xKXtsZXQgbDt0cnl7bD1CaWdJbnQoTWF0aC5yb3VuZChwZXJmb3JtYW5jZS5ub3coKSoxZTYpKX1jYXRjaHtsPTBufWEuc2V0QmlnVWludDY0KG8sbCwhMCl9ZWxzZSBhLnNldEJpZ1VpbnQ2NChvLDBuLCEwKTtyZXR1cm4gMH0sZmRfYWR2aXNlKG4saSxvLGEpe3JldHVybiBlLmZkc1tuXSE9bnVsbD9lLmZkc1tuXS5mZF9hZHZpc2UoaSxvLGEpOjh9LGZkX2FsbG9jYXRlKG4saSxvKXtyZXR1cm4gZS5mZHNbbl0hPW51bGw/ZS5mZHNbbl0uZmRfYWxsb2NhdGUoaSxvKTo4fSxmZF9jbG9zZShuKXtpZihlLmZkc1tuXSE9bnVsbCl7bGV0IGk9ZS5mZHNbbl0uZmRfY2xvc2UoKTtyZXR1cm4gZS5mZHNbbl09dm9pZCAwLGl9ZWxzZSByZXR1cm4gOH0sZmRfZGF0YXN5bmMobil7cmV0dXJuIGUuZmRzW25dIT1udWxsP2UuZmRzW25dLmZkX2RhdGFzeW5jKCk6OH0sZmRfZmRzdGF0X2dldChuLGkpe2lmKGUuZmRzW25dIT1udWxsKXtsZXR7cmV0Om8sZmRzdGF0OmF9PWUuZmRzW25dLmZkX2Zkc3RhdF9nZXQoKTtyZXR1cm4gYT8ud3JpdGVfYnl0ZXMobmV3IERhdGFWaWV3KGUuaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpLGkpLG99ZWxzZSByZXR1cm4gOH0sZmRfZmRzdGF0X3NldF9mbGFncyhuLGkpe3JldHVybiBlLmZkc1tuXSE9bnVsbD9lLmZkc1tuXS5mZF9mZHN0YXRfc2V0X2ZsYWdzKGkpOjh9LGZkX2Zkc3RhdF9zZXRfcmlnaHRzKG4saSxvKXtyZXR1cm4gZS5mZHNbbl0hPW51bGw/ZS5mZHNbbl0uZmRfZmRzdGF0X3NldF9yaWdodHMoaSxvKTo4fSxmZF9maWxlc3RhdF9nZXQobixpKXtpZihlLmZkc1tuXSE9bnVsbCl7bGV0e3JldDpvLGZpbGVzdGF0OmF9PWUuZmRzW25dLmZkX2ZpbGVzdGF0X2dldCgpO3JldHVybiBhPy53cml0ZV9ieXRlcyhuZXcgRGF0YVZpZXcoZS5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlciksaSksb31lbHNlIHJldHVybiA4fSxmZF9maWxlc3RhdF9zZXRfc2l6ZShuLGkpe3JldHVybiBlLmZkc1tuXSE9bnVsbD9lLmZkc1tuXS5mZF9maWxlc3RhdF9zZXRfc2l6ZShpKTo4fSxmZF9maWxlc3RhdF9zZXRfdGltZXMobixpLG8sYSl7cmV0dXJuIGUuZmRzW25dIT1udWxsP2UuZmRzW25dLmZkX2ZpbGVzdGF0X3NldF90aW1lcyhpLG8sYSk6OH0sZmRfcHJlYWQobixpLG8sYSxsKXtsZXQgZj1uZXcgRGF0YVZpZXcoZS5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlciksYz1uZXcgVWludDhBcnJheShlLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihlLmZkc1tuXSE9bnVsbCl7bGV0IGQ9eC5yZWFkX2J5dGVzX2FycmF5KGYsaSxvKSx7cmV0OmIsbnJlYWQ6cH09ZS5mZHNbbl0uZmRfcHJlYWQoYyxkLGEpO3JldHVybiBmLnNldFVpbnQzMihsLHAsITApLGJ9ZWxzZSByZXR1cm4gOH0sZmRfcHJlc3RhdF9nZXQobixpKXtsZXQgbz1uZXcgRGF0YVZpZXcoZS5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7aWYoZS5mZHNbbl0hPW51bGwpe2xldHtyZXQ6YSxwcmVzdGF0Omx9PWUuZmRzW25dLmZkX3ByZXN0YXRfZ2V0KCk7cmV0dXJuIGw/LndyaXRlX2J5dGVzKG8saSksYX1lbHNlIHJldHVybiA4fSxmZF9wcmVzdGF0X2Rpcl9uYW1lKG4saSxvKXtpZihlLmZkc1tuXSE9bnVsbCl7bGV0e3JldDphLHByZXN0YXRfZGlyX25hbWU6bH09ZS5mZHNbbl0uZmRfcHJlc3RhdF9kaXJfbmFtZSgpO3JldHVybiBsIT1udWxsJiZuZXcgVWludDhBcnJheShlLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKS5zZXQobCxpKSxhfWVsc2UgcmV0dXJuIDh9LGZkX3B3cml0ZShuLGksbyxhLGwpe2xldCBmPW5ldyBEYXRhVmlldyhlLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKSxjPW5ldyBVaW50OEFycmF5KGUuaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO2lmKGUuZmRzW25dIT1udWxsKXtsZXQgZD1tLnJlYWRfYnl0ZXNfYXJyYXkoZixpLG8pLHtyZXQ6Yixud3JpdHRlbjpwfT1lLmZkc1tuXS5mZF9wd3JpdGUoYyxkLGEpO3JldHVybiBmLnNldFVpbnQzMihsLHAsITApLGJ9ZWxzZSByZXR1cm4gOH0sZmRfcmVhZChuLGksbyxhKXtsZXQgbD1uZXcgRGF0YVZpZXcoZS5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlciksZj1uZXcgVWludDhBcnJheShlLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihlLmZkc1tuXSE9bnVsbCl7bGV0IGM9eC5yZWFkX2J5dGVzX2FycmF5KGwsaSxvKSx7cmV0OmQsbnJlYWQ6Yn09ZS5mZHNbbl0uZmRfcmVhZChmLGMpO3JldHVybiBsLnNldFVpbnQzMihhLGIsITApLGR9ZWxzZSByZXR1cm4gOH0sZmRfcmVhZGRpcihuLGksbyxhLGwpe2xldCBmPW5ldyBEYXRhVmlldyhlLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKSxjPW5ldyBVaW50OEFycmF5KGUuaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO2lmKGUuZmRzW25dIT1udWxsKXtsZXQgZD0wO2Zvcig7Oyl7bGV0e3JldDpiLGRpcmVudDpwfT1lLmZkc1tuXS5mZF9yZWFkZGlyX3NpbmdsZShhKTtpZihiIT0wKXJldHVybiBmLnNldFVpbnQzMihsLGQsITApLGI7aWYocD09bnVsbClicmVhaztpZihvLWQ8cC5oZWFkX2xlbmd0aCgpKXtkPW87YnJlYWt9bGV0IEU9bmV3IEFycmF5QnVmZmVyKHAuaGVhZF9sZW5ndGgoKSk7aWYocC53cml0ZV9oZWFkX2J5dGVzKG5ldyBEYXRhVmlldyhFKSwwKSxjLnNldChuZXcgVWludDhBcnJheShFKS5zbGljZSgwLE1hdGgubWluKEUuYnl0ZUxlbmd0aCxvLWQpKSxpKSxpKz1wLmhlYWRfbGVuZ3RoKCksZCs9cC5oZWFkX2xlbmd0aCgpLG8tZDxwLm5hbWVfbGVuZ3RoKCkpe2Q9bzticmVha31wLndyaXRlX25hbWVfYnl0ZXMoYyxpLG8tZCksaSs9cC5uYW1lX2xlbmd0aCgpLGQrPXAubmFtZV9sZW5ndGgoKSxhPXAuZF9uZXh0fXJldHVybiBmLnNldFVpbnQzMihsLGQsITApLDB9ZWxzZSByZXR1cm4gOH0sZmRfcmVudW1iZXIobixpKXtpZihlLmZkc1tuXSE9bnVsbCYmZS5mZHNbaV0hPW51bGwpe2xldCBvPWUuZmRzW2ldLmZkX2Nsb3NlKCk7cmV0dXJuIG8hPTA/bzooZS5mZHNbaV09ZS5mZHNbbl0sZS5mZHNbbl09dm9pZCAwLDApfWVsc2UgcmV0dXJuIDh9LGZkX3NlZWsobixpLG8sYSl7bGV0IGw9bmV3IERhdGFWaWV3KGUuaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO2lmKGUuZmRzW25dIT1udWxsKXtsZXR7cmV0OmYsb2Zmc2V0OmN9PWUuZmRzW25dLmZkX3NlZWsoaSxvKTtyZXR1cm4gbC5zZXRCaWdJbnQ2NChhLGMsITApLGZ9ZWxzZSByZXR1cm4gOH0sZmRfc3luYyhuKXtyZXR1cm4gZS5mZHNbbl0hPW51bGw/ZS5mZHNbbl0uZmRfc3luYygpOjh9LGZkX3RlbGwobixpKXtsZXQgbz1uZXcgRGF0YVZpZXcoZS5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7aWYoZS5mZHNbbl0hPW51bGwpe2xldHtyZXQ6YSxvZmZzZXQ6bH09ZS5mZHNbbl0uZmRfdGVsbCgpO3JldHVybiBvLnNldEJpZ1VpbnQ2NChpLGwsITApLGF9ZWxzZSByZXR1cm4gOH0sZmRfd3JpdGUobixpLG8sYSl7bGV0IGw9bmV3IERhdGFWaWV3KGUuaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpLGY9bmV3IFVpbnQ4QXJyYXkoZS5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7aWYoZS5mZHNbbl0hPW51bGwpe2xldCBjPW0ucmVhZF9ieXRlc19hcnJheShsLGksbykse3JldDpkLG53cml0dGVuOmJ9PWUuZmRzW25dLmZkX3dyaXRlKGYsYyk7cmV0dXJuIGwuc2V0VWludDMyKGEsYiwhMCksZH1lbHNlIHJldHVybiA4fSxwYXRoX2NyZWF0ZV9kaXJlY3RvcnkobixpLG8pe2xldCBhPW5ldyBVaW50OEFycmF5KGUuaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO2lmKGUuZmRzW25dIT1udWxsKXtsZXQgbD1uZXcgVGV4dERlY29kZXIoInV0Zi04IikuZGVjb2RlKGEuc2xpY2UoaSxpK28pKTtyZXR1cm4gZS5mZHNbbl0ucGF0aF9jcmVhdGVfZGlyZWN0b3J5KGwpfX0scGF0aF9maWxlc3RhdF9nZXQobixpLG8sYSxsKXtsZXQgZj1uZXcgRGF0YVZpZXcoZS5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlciksYz1uZXcgVWludDhBcnJheShlLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihlLmZkc1tuXSE9bnVsbCl7bGV0IGQ9bmV3IFRleHREZWNvZGVyKCJ1dGYtOCIpLmRlY29kZShjLnNsaWNlKG8sbythKSkse3JldDpiLGZpbGVzdGF0OnB9PWUuZmRzW25dLnBhdGhfZmlsZXN0YXRfZ2V0KGksZCk7cmV0dXJuIHA/LndyaXRlX2J5dGVzKGYsbCksYn1lbHNlIHJldHVybiA4fSxwYXRoX2ZpbGVzdGF0X3NldF90aW1lcyhuLGksbyxhLGwsZixjKXtsZXQgZD1uZXcgVWludDhBcnJheShlLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihlLmZkc1tuXSE9bnVsbCl7bGV0IGI9bmV3IFRleHREZWNvZGVyKCJ1dGYtOCIpLmRlY29kZShkLnNsaWNlKG8sbythKSk7cmV0dXJuIGUuZmRzW25dLnBhdGhfZmlsZXN0YXRfc2V0X3RpbWVzKGksYixsLGYsYyl9ZWxzZSByZXR1cm4gOH0scGF0aF9saW5rKG4saSxvLGEsbCxmLGMpe2xldCBkPW5ldyBVaW50OEFycmF5KGUuaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO2lmKGUuZmRzW25dIT1udWxsJiZlLmZkc1tsXSE9bnVsbCl7bGV0IGI9bmV3IFRleHREZWNvZGVyKCJ1dGYtOCIpLmRlY29kZShkLnNsaWNlKG8sbythKSkscD1uZXcgVGV4dERlY29kZXIoInV0Zi04IikuZGVjb2RlKGQuc2xpY2UoZixmK2MpKTtyZXR1cm4gZS5mZHNbbF0ucGF0aF9saW5rKG4saSxiLHApfWVsc2UgcmV0dXJuIDh9LHBhdGhfb3BlbihuLGksbyxhLGwsZixjLGQsYil7bGV0IHA9bmV3IERhdGFWaWV3KGUuaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpLEU9bmV3IFVpbnQ4QXJyYXkoZS5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7aWYoZS5mZHNbbl0hPW51bGwpe2xldCBvdD1uZXcgVGV4dERlY29kZXIoInV0Zi04IikuZGVjb2RlKEUuc2xpY2UobyxvK2EpKSx7cmV0OiQsZmRfb2JqOmF0fT1lLmZkc1tuXS5wYXRoX29wZW4oaSxvdCxsLGYsYyxkKTtpZigkIT0wKXJldHVybiAkO2UuZmRzLnB1c2goYXQpO2xldCBsdD1lLmZkcy5sZW5ndGgtMTtyZXR1cm4gcC5zZXRVaW50MzIoYixsdCwhMCksMH1lbHNlIHJldHVybiA4fSxwYXRoX3JlYWRsaW5rKG4saSxvLGEsbCxmKXtsZXQgYz1uZXcgRGF0YVZpZXcoZS5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlciksZD1uZXcgVWludDhBcnJheShlLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihlLmZkc1tuXSE9bnVsbCl7bGV0IGI9bmV3IFRleHREZWNvZGVyKCJ1dGYtOCIpLmRlY29kZShkLnNsaWNlKGksaStvKSkse3JldDpwLGRhdGE6RX09ZS5mZHNbbl0ucGF0aF9yZWFkbGluayhiKTtpZihFIT1udWxsKXtpZihFLmxlbmd0aD5sKXJldHVybiBjLnNldFVpbnQzMihmLDAsITApLDg7ZC5zZXQoRSxhKSxjLnNldFVpbnQzMihmLEUubGVuZ3RoLCEwKX1yZXR1cm4gcH1lbHNlIHJldHVybiA4fSxwYXRoX3JlbW92ZV9kaXJlY3RvcnkobixpLG8pe2xldCBhPW5ldyBVaW50OEFycmF5KGUuaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO2lmKGUuZmRzW25dIT1udWxsKXtsZXQgbD1uZXcgVGV4dERlY29kZXIoInV0Zi04IikuZGVjb2RlKGEuc2xpY2UoaSxpK28pKTtyZXR1cm4gZS5mZHNbbl0ucGF0aF9yZW1vdmVfZGlyZWN0b3J5KGwpfWVsc2UgcmV0dXJuIDh9LHBhdGhfcmVuYW1lKG4saSxvLGEsbCxmKXt0aHJvdyJGSVhNRSB3aGF0IGlzIHRoZSBiZXN0IGFic3RyYWN0aW9uIGZvciB0aGlzPyJ9LHBhdGhfc3ltbGluayhuLGksbyxhLGwpe2xldCBmPW5ldyBVaW50OEFycmF5KGUuaW5zdC5leHBvcnRzLm1lbW9yeS5idWZmZXIpO2lmKGUuZmRzW29dIT1udWxsKXtsZXQgYz1uZXcgVGV4dERlY29kZXIoInV0Zi04IikuZGVjb2RlKGYuc2xpY2UobixuK2kpKSxkPW5ldyBUZXh0RGVjb2RlcigidXRmLTgiKS5kZWNvZGUoZi5zbGljZShhLGErbCkpO3JldHVybiBlLmZkc1tvXS5wYXRoX3N5bWxpbmsoYyxkKX1lbHNlIHJldHVybiA4fSxwYXRoX3VubGlua19maWxlKG4saSxvKXtsZXQgYT1uZXcgVWludDhBcnJheShlLmluc3QuZXhwb3J0cy5tZW1vcnkuYnVmZmVyKTtpZihlLmZkc1tuXSE9bnVsbCl7bGV0IGw9bmV3IFRleHREZWNvZGVyKCJ1dGYtOCIpLmRlY29kZShhLnNsaWNlKGksaStvKSk7cmV0dXJuIGUuZmRzW25dLnBhdGhfdW5saW5rX2ZpbGUobCl9ZWxzZSByZXR1cm4gOH0scG9sbF9vbmVvZmYobixpLG8pe3Rocm93ImFzeW5jIGlvIG5vdCBzdXBwb3J0ZWQifSxwcm9jX2V4aXQobil7dGhyb3ciZXhpdCB3aXRoIGV4aXQgY29kZSAiK259LHByb2NfcmFpc2Uobil7dGhyb3cicmFpc2VkIHNpZ25hbCAiK259LHNjaGVkX3lpZWxkKCl7fSxyYW5kb21fZ2V0KG4saSl7bGV0IG89bmV3IFVpbnQ4QXJyYXkoZS5pbnN0LmV4cG9ydHMubWVtb3J5LmJ1ZmZlcik7Zm9yKGxldCBhPTA7YTxpO2ErKylvW24rYV09TWF0aC5yYW5kb20oKSoyNTZ8MH0sc29ja19yZWN2KG4saSxvKXt0aHJvdyJzb2NrZXRzIG5vdCBzdXBwb3J0ZWQifSxzb2NrX3NlbmQobixpLG8pe3Rocm93InNvY2tldHMgbm90IHN1cHBvcnRlZCJ9LHNvY2tfc2h1dGRvd24obixpKXt0aHJvdyJzb2NrZXRzIG5vdCBzdXBwb3J0ZWQifX19fTt2YXIgTj1jbGFzc3tmZF9hZHZpc2UodCxyLHMpe3JldHVybi0xfWZkX2FsbG9jYXRlKHQscil7cmV0dXJuLTF9ZmRfY2xvc2UoKXtyZXR1cm4gMH1mZF9kYXRhc3luYygpe3JldHVybi0xfWZkX2Zkc3RhdF9nZXQoKXtyZXR1cm57cmV0Oi0xLGZkc3RhdDpudWxsfX1mZF9mZHN0YXRfc2V0X2ZsYWdzKHQpe3JldHVybi0xfWZkX2Zkc3RhdF9zZXRfcmlnaHRzKHQscil7cmV0dXJuLTF9ZmRfZmlsZXN0YXRfZ2V0KCl7cmV0dXJue3JldDotMSxmaWxlc3RhdDpudWxsfX1mZF9maWxlc3RhdF9zZXRfc2l6ZSh0KXtyZXR1cm4tMX1mZF9maWxlc3RhdF9zZXRfdGltZXModCxyLHMpe3JldHVybi0xfWZkX3ByZWFkKHQscixzKXtyZXR1cm57cmV0Oi0xLG5yZWFkOjB9fWZkX3ByZXN0YXRfZ2V0KCl7cmV0dXJue3JldDotMSxwcmVzdGF0Om51bGx9fWZkX3ByZXN0YXRfZGlyX25hbWUodCxyKXtyZXR1cm57cmV0Oi0xLHByZXN0YXRfZGlyX25hbWU6bnVsbH19ZmRfcHdyaXRlKHQscixzKXtyZXR1cm57cmV0Oi0xLG53cml0dGVuOjB9fWZkX3JlYWQodCxyKXtyZXR1cm57cmV0Oi0xLG5yZWFkOjB9fWZkX3JlYWRkaXJfc2luZ2xlKHQpe3JldHVybntyZXQ6LTEsZGlyZW50Om51bGx9fWZkX3NlZWsodCxyKXtyZXR1cm57cmV0Oi0xLG9mZnNldDowbn19ZmRfc3luYygpe3JldHVybiAwfWZkX3RlbGwoKXtyZXR1cm57cmV0Oi0xLG9mZnNldDowbn19ZmRfd3JpdGUodCxyKXtyZXR1cm57cmV0Oi0xLG53cml0dGVuOjB9fXBhdGhfY3JlYXRlX2RpcmVjdG9yeSh0KXtyZXR1cm4tMX1wYXRoX2ZpbGVzdGF0X2dldCh0LHIpe3JldHVybntyZXQ6LTEsZmlsZXN0YXQ6bnVsbH19cGF0aF9maWxlc3RhdF9zZXRfdGltZXModCxyLHMsZSxuKXtyZXR1cm4tMX1wYXRoX2xpbmsodCxyLHMsZSl7cmV0dXJuLTF9cGF0aF9vcGVuKHQscixzLGUsbixpKXtyZXR1cm57cmV0Oi0xLGZkX29iajpudWxsfX1wYXRoX3JlYWRsaW5rKHQpe3JldHVybntyZXQ6LTEsZGF0YTpudWxsfX1wYXRoX3JlbW92ZV9kaXJlY3RvcnkodCl7cmV0dXJuLTF9cGF0aF9yZW5hbWUodCxyLHMpe3JldHVybi0xfXBhdGhfc3ltbGluayh0LHIpe3JldHVybi0xfXBhdGhfdW5saW5rX2ZpbGUodCl7cmV0dXJuLTF9fTt2YXIgUj1jbGFzc3tnZXQgc2l6ZSgpe3JldHVybiBCaWdJbnQodGhpcy5kYXRhLmJ5dGVMZW5ndGgpfXN0YXQoKXtyZXR1cm4gbmV3IFUoQix0aGlzLnNpemUpfXRydW5jYXRlKCl7dGhpcy5kYXRhPW5ldyBVaW50OEFycmF5KFtdKX1jb25zdHJ1Y3Rvcih0KXt0aGlzLmRhdGE9bmV3IFVpbnQ4QXJyYXkodCl9fTt2YXIgeT1jbGFzcyBleHRlbmRzIE57ZmRfZmRzdGF0X2dldCgpe3JldHVybntyZXQ6MCxmZHN0YXQ6bmV3IGsoQiwwKX19ZmRfcmVhZCh0LHIpe2xldCBzPTA7Zm9yKGxldCBlIG9mIHIpaWYodGhpcy5maWxlX3Bvczx0aGlzLmZpbGUuZGF0YS5ieXRlTGVuZ3RoKXtsZXQgbj10aGlzLmZpbGUuZGF0YS5zbGljZShOdW1iZXIodGhpcy5maWxlX3BvcyksTnVtYmVyKHRoaXMuZmlsZV9wb3MrQmlnSW50KGUuYnVmX2xlbikpKTt0LnNldChuLGUuYnVmKSx0aGlzLmZpbGVfcG9zKz1CaWdJbnQobi5sZW5ndGgpLHMrPW4ubGVuZ3RofWVsc2UgYnJlYWs7cmV0dXJue3JldDowLG5yZWFkOnN9fWZkX3NlZWsodCxyKXtsZXQgcztzd2l0Y2gocil7Y2FzZSB0dDpzPXQ7YnJlYWs7Y2FzZSBldDpzPXRoaXMuZmlsZV9wb3MrdDticmVhaztjYXNlIHJ0OnM9QmlnSW50KHRoaXMuZmlsZS5kYXRhLmJ5dGVMZW5ndGgpK3Q7YnJlYWs7ZGVmYXVsdDpyZXR1cm57cmV0OjI4LG9mZnNldDowbn19cmV0dXJuIHM8MD97cmV0OjI4LG9mZnNldDowbn06KHRoaXMuZmlsZV9wb3M9cyx7cmV0OjAsb2Zmc2V0OnRoaXMuZmlsZV9wb3N9KX1mZF93cml0ZSh0LHIpe2xldCBzPTA7Zm9yKGxldCBlIG9mIHIpe2xldCBuPXQuc2xpY2UoZS5idWYsZS5idWYrZS5idWZfbGVuKTtpZih0aGlzLmZpbGVfcG9zK0JpZ0ludChuLmJ5dGVMZW5ndGgpPnRoaXMuZmlsZS5zaXplKXtsZXQgaT10aGlzLmZpbGUuZGF0YTt0aGlzLmZpbGUuZGF0YT1uZXcgVWludDhBcnJheShOdW1iZXIodGhpcy5maWxlX3BvcytCaWdJbnQobi5ieXRlTGVuZ3RoKSkpLHRoaXMuZmlsZS5kYXRhLnNldChpKX10aGlzLmZpbGUuZGF0YS5zZXQobi5zbGljZSgwLE51bWJlcih0aGlzLmZpbGUuc2l6ZS10aGlzLmZpbGVfcG9zKSksTnVtYmVyKHRoaXMuZmlsZV9wb3MpKSx0aGlzLmZpbGVfcG9zKz1CaWdJbnQobi5ieXRlTGVuZ3RoKSxzKz1lLmJ1Zl9sZW59cmV0dXJue3JldDowLG53cml0dGVuOnN9fWZkX2ZpbGVzdGF0X2dldCgpe3JldHVybntyZXQ6MCxmaWxlc3RhdDp0aGlzLmZpbGUuc3RhdCgpfX1jb25zdHJ1Y3Rvcih0KXtzdXBlcigpLHRoaXMuZmlsZV9wb3M9MG4sdGhpcy5maWxlPXR9fTthc3luYyBmdW5jdGlvbiBzdCh1KXtsZXQgdD1bXSxyPVtdLHM9W25ldyB5KG5ldyBSKFtdKSksbmV3IHkobmV3IFIoW10pKSxuZXcgeShuZXcgUihbXSkpXSxlPW5ldyB6KHQscixzKTtyZXR1cm57YXN5bmMgaW1wb3J0T2JqZWN0KCl7cmV0dXJuIGUud2FzaUltcG9ydH0sYXN5bmMgaW5pdGlhbGl6ZShuKXtsZXQgaT1uLmV4cG9ydHMubWVtb3J5O2lmKCFpKXRocm93IG5ldyBFcnJvcigiVGhlIG1vZHVsZSBoYXMgdG8gZXhwb3J0IGEgZGVmYXVsdCBtZW1vcnkuIik7aWYobi5leHBvcnRzLl9pbml0aWFsaXplKXtsZXQgbz1uLmV4cG9ydHMuX2luaXRpYWxpemU7ZS5pbml0aWFsaXplP2UuaW5pdGlhbGl6ZSh7ZXhwb3J0czp7bWVtb3J5OmksX2luaXRpYWxpemU6KCk9PntvKCl9fX0pOm8oKX1lbHNlIG4uZXhwb3J0cy5fc3RhcnQmJmUuc3RhcnQoe2V4cG9ydHM6e21lbW9yeTppLF9zdGFydDooKT0+e319fSl9fX12YXIgeHQ9ImV4dGlzbTpob3N0L2VudiIsWD1jbGFzc3sjZTsjdDsjcjsjbj0hMTtjb25zdHJ1Y3Rvcih0LHIscyl7dGhpcy4jZT10LHRoaXMuI3I9cix0aGlzLiN0PXN9YXN5bmMgcmVzZXQoKXtyZXR1cm4gdGhpcy5pc0FjdGl2ZSgpPyExOih0aGlzLiNlW1ldKCksITApfWlzQWN0aXZlKCl7cmV0dXJuIHRoaXMuI259YXN5bmMgZnVuY3Rpb25FeGlzdHModCl7dHJ5e2xldCByPVtdLmNvbmNhdCh0KSxbcyxlXT1yLmxlbmd0aD09PTI/W3RoaXMubG9va3VwVGFyZ2V0KHJbMF0pLHJbMV1dOlt0aGlzLiN0LmZpbmQoaT0+V2ViQXNzZW1ibHkuTW9kdWxlLmV4cG9ydHMoaS5tb2R1bGUpLmZpbmQoYT0+YS5uYW1lPT09clswXSYmYS5raW5kPT09ImZ1bmN0aW9uIikpLHJbMF1dO3JldHVybiEoIXN8fCFzLmluc3RhbmNlLmV4cG9ydHNbZV0pfWNhdGNoe3JldHVybiExfX1hc3luYyBjYWxsQmxvY2sodCxyKXt0aGlzLiNuPSEwO2xldCBzPVtdLmNvbmNhdCh0KSxbZSxuXT1zLmxlbmd0aD09PTI/W3RoaXMubG9va3VwVGFyZ2V0KHNbMF0pLHNbMV1dOlt0aGlzLiN0LmZpbmQobz0+V2ViQXNzZW1ibHkuTW9kdWxlLmV4cG9ydHMoby5tb2R1bGUpLmZpbmQobD0+bC5uYW1lPT09c1swXSYmbC5raW5kPT09ImZ1bmN0aW9uIikpLHNbMF1dO2lmKCFlKXRocm93IEVycm9yKGBQbHVnaW4gZXJyb3I6IHRhcmdldCAiJHtzLmpvaW4oJyIgIicpfSIgZG9lcyBub3QgZXhpc3RgKTtsZXQgaT1lLmluc3RhbmNlLmV4cG9ydHNbbl07aWYoIWkpdGhyb3cgRXJyb3IoYFBsdWdpbiBlcnJvcjogZnVuY3Rpb24gIiR7cy5qb2luKCciICInKX0iIGRvZXMgbm90IGV4aXN0YCk7dGhpcy4jZVt2XShyPz9udWxsKTt0cnl7cmV0dXJuIGkoKSx0aGlzLiNlW0xdKCl9Y2F0Y2gobyl7dGhyb3cgdGhpcy4jZVtMXSgpLG99ZmluYWxseXt0aGlzLiNuPSExfX1hc3luYyBjYWxsKHQscil7bGV0IHM9dGhpcy4jZVtUXShyKSxbZSxuXT1hd2FpdCB0aGlzLmNhbGxCbG9jayh0LHMpLGk9ZSE9PW51bGwsbz1lPz9uO2lmKG89PT1udWxsKXJldHVybiBudWxsO2xldCBhPXRoaXMuI2VbVl0obyk7aWYoIWEpcmV0dXJuIG51bGw7bGV0IGw9bmV3IHcoYS5idWZmZXIpO2lmKGkpdGhyb3cgbmV3IEVycm9yKGBQbHVnaW4tb3JpZ2luYXRlZCBlcnJvcjogJHtsLnN0cmluZygpfWApO3JldHVybiBsfWxvb2t1cFRhcmdldCh0KXtsZXQgcj1TdHJpbmcodD8/IjAiKSxzPXRoaXMuI3IuZmluZEluZGV4KGU9PmU9PT1yKTtpZihzPT09LTEpdGhyb3cgbmV3IEVycm9yKGBubyBtb2R1bGUgbmFtZWQgIiR7dH0iYCk7cmV0dXJuIHRoaXMuI3Rbc119YXN5bmMgZ2V0RXhwb3J0cyh0KXtyZXR1cm4gV2ViQXNzZW1ibHkuTW9kdWxlLmV4cG9ydHModGhpcy5sb29rdXBUYXJnZXQodCkubW9kdWxlKXx8W119YXN5bmMgZ2V0SW1wb3J0cyh0KXtyZXR1cm4gV2ViQXNzZW1ibHkuTW9kdWxlLmltcG9ydHModGhpcy5sb29rdXBUYXJnZXQodCkubW9kdWxlKXx8W119YXN5bmMgZ2V0SW5zdGFuY2UodCl7cmV0dXJuIHRoaXMubG9va3VwVGFyZ2V0KHQpLmluc3RhbmNlfWFzeW5jIGNsb3NlKCl7fX07YXN5bmMgZnVuY3Rpb24gaXQodSx0LHIscz1uZXcgQShBcnJheUJ1ZmZlcix1LmxvZ2dlcix1LmNvbmZpZykpe2xldCBlPXUud2FzaUVuYWJsZWQ/YXdhaXQgc3QodS5hbGxvd2VkUGF0aHMpOm51bGwsbj17Li4uZT97d2FzaV9zbmFwc2hvdF9wcmV2aWV3MTphd2FpdCBlLmltcG9ydE9iamVjdCgpfTp7fSxbeHRdOnNbV10sZW52Ont9fTtmb3IobGV0IG8gaW4gdS5mdW5jdGlvbnMpe25bb109bltvXXx8e307Zm9yKGxldCBhIGluIHUuZnVuY3Rpb25zW29dKW5bb11bYV09dS5mdW5jdGlvbnNbb11bYV0uYmluZChudWxsLHMpfWxldCBpPWF3YWl0IFByb21pc2UuYWxsKHIubWFwKGFzeW5jIG89PntsZXQgYT1hd2FpdCBXZWJBc3NlbWJseS5pbnN0YW50aWF0ZShvLG4pO2UmJmF3YWl0IGU/LmluaXRpYWxpemUoYSk7bGV0IGw9YS5leHBvcnRzLmhzX2luaXQ/Imhhc2tlbGwiOmEuZXhwb3J0cy5faW5pdGlhbGl6ZT8icmVhY3RvciI6YS5leHBvcnRzLl9zdGFydD8iY29tbWFuZCI6Im5vbmUiO3JldHVybihhLmV4cG9ydHMuaHNfaW5pdD9hLmV4cG9ydHMuaHNfaW5pdDooKT0+e30pKCkse21vZHVsZTpvLGluc3RhbmNlOmEsZ3Vlc3RUeXBlOmx9fSkpO3JldHVybiBuZXcgWChzLHQsaSl9dmFyIFA9NWUzLGo9Y2xhc3N7aG9zdEZsYWc7c2hhcmVkRGF0YTtzaGFyZWREYXRhVmlldztwbHVnaW47cG9ydDtkeW5hbWljSGFuZGxlcnM7Y29udGV4dDtjb25zdHJ1Y3Rvcih0KXtpZighdCl0aHJvdyBuZXcgRXJyb3IoIlRoaXMgc2hvdWxkIGJlIHVucmVhY2hhYmxlOiB0aGlzIG1vZHVsZSBzaG91bGQgb25seSBiZSBpbnZva2VkIGFzIGEgd2ViIHdvcmtlci4iKTt0aGlzLnNoYXJlZERhdGE9bnVsbCx0aGlzLnNoYXJlZERhdGFWaWV3PW51bGwsdGhpcy5ob3N0RmxhZz1udWxsLHRoaXMucG9ydD10LHRoaXMucG9ydC5vbigibWVzc2FnZSIscj0+dGhpcy5oYW5kbGVNZXNzYWdlKHIpKSx0aGlzLnBvcnQucG9zdE1lc3NhZ2Uoe3R5cGU6ImluaXRpYWxpemVkIn0pLHRoaXMuZHluYW1pY0hhbmRsZXJzPW5ldyBNYXAsdGhpcy5keW5hbWljSGFuZGxlcnMuc2V0KCJjYWxsIixhc3luYyhyLHMsZSxuKT0+e2lmKCF0aGlzLmNvbnRleHQpdGhyb3cgbmV3IEVycm9yKCJpbnZhbGlkIHN0YXRlOiBubyBjb250ZXh0IGF2YWlsYWJsZSB0byB3b3JrZXIgcmVhY3RvciIpO3RoaXMuY29udGV4dFtDXShuKTtsZXQgaT1hd2FpdCB0aGlzLnBsdWdpbj8uY2FsbEJsb2NrKHMsZSkudGhlbihvPT5bbnVsbCxvXSxvPT5bbyxudWxsXSk7bj10aGlzLmNvbnRleHRbRl0oKTtmb3IobGV0W29db2Ygbi5ibG9ja3MpbyYmci5wdXNoKG8pO3JldHVybiBpWzBdJiYoaVswXT17b3JpZ2luYWxTdGFjazppWzBdPy5zdGFjayxtZXNzYWdlOmlbMF0/Lm1lc3NhZ2V9KSx7cmVzdWx0czppLHN0YXRlOm59fSksdGhpcy5keW5hbWljSGFuZGxlcnMuc2V0KCJyZXNldCIsYXN5bmMgcj0+dGhpcy5wbHVnaW4/LnJlc2V0KCkpLHRoaXMuZHluYW1pY0hhbmRsZXJzLnNldCgiZ2V0RXhwb3J0cyIsYXN5bmMocixzKT0+dGhpcy5wbHVnaW4/LmdldEV4cG9ydHMocykpLHRoaXMuZHluYW1pY0hhbmRsZXJzLnNldCgiZ2V0SW1wb3J0cyIsYXN5bmMocixzKT0+dGhpcy5wbHVnaW4/LmdldEltcG9ydHMocykpLHRoaXMuZHluYW1pY0hhbmRsZXJzLnNldCgiZnVuY3Rpb25FeGlzdHMiLGFzeW5jKHIscyk9PnRoaXMucGx1Z2luPy5mdW5jdGlvbkV4aXN0cyhzKSl9YXN5bmMgaGFuZGxlTWVzc2FnZSh0KXtzd2l0Y2godC50eXBlKXtjYXNlImluaXQiOnJldHVybiBhd2FpdCB0aGlzLmhhbmRsZUluaXQodCk7Y2FzZSJpbnZva2UiOnJldHVybiBhd2FpdCB0aGlzLmhhbmRsZUludm9rZSh0KX19YXN5bmMgaGFuZGxlSW52b2tlKHQpe2xldCByPXRoaXMuZHluYW1pY0hhbmRsZXJzLmdldCh0LmhhbmRsZXIpO2lmKCFyKXJldHVybiB0aGlzLnBvcnQucG9zdE1lc3NhZ2Uoe3R5cGU6InJldHVybiIscmVzdWx0Oltgbm8gaGFuZGxlciByZWdpc3RlcmVkIGZvciAke3QuaGFuZGxlcn1gLG51bGxdfSk7bGV0IHM9W10sZT1hd2FpdCByKHMsLi4udC5hcmdzfHxbXSkudGhlbihuPT5bbnVsbCxuXSxuPT5bbixudWxsXSk7cmV0dXJuIGVbMF0mJihlWzBdPXtvcmlnaW5hbFN0YWNrOmVbMF0/LnN0YWNrLG1lc3NhZ2U6ZVswXT8ubWVzc2FnZX0pLHRoaXMucG9ydC5wb3N0TWVzc2FnZSh7dHlwZToicmV0dXJuIixyZXN1bHRzOmV9LHMpfWFzeW5jIGhhbmRsZUluaXQodCl7dGhpcy5zaGFyZWREYXRhPXQuc2hhcmVkRGF0YSx0aGlzLnNoYXJlZERhdGFWaWV3PW5ldyBEYXRhVmlldyh0LnNoYXJlZERhdGEpLHRoaXMuaG9zdEZsYWc9bmV3IEludDMyQXJyYXkodGhpcy5zaGFyZWREYXRhKTtsZXQgcj1PYmplY3QuZnJvbUVudHJpZXMoT2JqZWN0LmVudHJpZXModC5mdW5jdGlvbnMpLm1hcCgoW2wsZl0pPT5bbCxPYmplY3QuZnJvbUVudHJpZXMoZi5tYXAoYz0+W2MsKGQsLi4uYik9PnRoaXMuY2FsbEhvc3QoZCxsLGMsYildKSldKSkse3R5cGU6cyxtb2R1bGVzOmUsZnVuY3Rpb25zOm4sLi4uaX09dCxvPWw9PmY9PnRoaXMucG9ydC5wb3N0TWVzc2FnZSh7dHlwZToibG9nIixsZXZlbDpsLG1lc3NhZ2U6Zn0pLGE9T2JqZWN0LmZyb21FbnRyaWVzKFsiaW5mbyIsImRlYnVnIiwid2FybiIsImVycm9yIl0ubWFwKGw9PltsLG8obCldKSk7dGhpcy5jb250ZXh0PW5ldyBBKEFycmF5QnVmZmVyLGEsdC5jb25maWcpLHRoaXMucGx1Z2luPWF3YWl0IGl0KHsuLi5pLGZ1bmN0aW9uczpyLGZldGNoLGxvZ2dlcjphfSx0Lm5hbWVzLGUsdGhpcy5jb250ZXh0KSx0aGlzLnBvcnQucG9zdE1lc3NhZ2Uoe3R5cGU6InJlYWR5In0pfWNhbGxIb3N0KHQscixzLGUpe2lmKCF0aGlzLmhvc3RGbGFnKXRocm93IG5ldyBFcnJvcigiYXR0ZW1wdGVkIHRvIGNhbGwgaG9zdCBiZWZvcmUgcmVjZWl2aW5nIHNoYXJlZCBhcnJheSBidWZmZXIiKTtsZXQgbj10W0ZdKCk7dGhpcy5wb3J0LnBvc3RNZXNzYWdlKHt0eXBlOiJpbnZva2UiLG5hbWVzcGFjZTpyLGZ1bmM6cyxhcmdzOmUsc3RhdGU6bn0pO2xldCBpPW5ldyBJKHRoaXMuc2hhcmVkRGF0YSksbz1bXSxhO2Rve2xldCBsPWkucmVhZFVpbnQ4KCk7c3dpdGNoKGwpe2Nhc2UgMDpyZXR1cm4gbi5ibG9ja3M9byx0W0NdKG4pLGkuY2xvc2UoKSx0aGlzLmhvc3RGbGFnWzBdPUkuU0FCX0JBU0VfT0ZGU0VULGE7Y2FzZSAxOmE9aS5yZWFkVWludDY0KCk7YnJlYWs7Y2FzZSAyOmE9aS5yZWFkRmxvYXQ2NCgpO2JyZWFrO2Nhc2UgMzphPXZvaWQgMDticmVhaztjYXNlIDQ6e2xldCBmPWkucmVhZFVpbnQzMigpLGM9aS5yZWFkVWludDMyKCk7aWYoIWMpby5wdXNoKFtudWxsLGZdKTtlbHNle2xldCBkPW5ldyBVaW50OEFycmF5KGMpO2kucmVhZChkKSxvLnB1c2goW2QuYnVmZmVyLGZdKX19YnJlYWs7ZGVmYXVsdDp0aHJvdyBuZXcgRXJyb3IoYGludmFsaWQgc2VjdGlvbiB0eXBlPSIke2x9IjsgcGxlYXNlIG9wZW4gYW4gaXNzdWUgKGh0dHBzOi8vZ2l0aHViLmNvbS9leHRpc20vanMtc2RrL2lzc3Vlcy9uZXc/dGl0bGU9c2hhcmVkK2FycmF5K2J1ZmZlcitiYWQrc2VjdGlvbit0eXBlKyR7bH0mbGFiZWxzPWJ1ZylgKX19d2hpbGUoMSl9fTtuZXcgaihxKTt2YXIgZz1jbGFzc3tpbnB1dDtmbGFnO2lucHV0T2Zmc2V0O3NjcmF0Y2g7c2NyYXRjaFZpZXc7ZXhwZWN0ZWQ7Y29uc3RydWN0b3IodCl7dGhpcy5pbnB1dD10LHRoaXMuaW5wdXRPZmZzZXQ9Zy5TQUJfQkFTRV9PRkZTRVQsdGhpcy5mbGFnPW5ldyBJbnQzMkFycmF5KHRoaXMuaW5wdXQpLHRoaXMuc2NyYXRjaD1uZXcgQXJyYXlCdWZmZXIoOCksdGhpcy5zY3JhdGNoVmlldz1uZXcgRGF0YVZpZXcodGhpcy5zY3JhdGNoKSx0aGlzLmV4cGVjdGVkPTAsdGhpcy5wdWxsKCExKX1nZXQgYXZhaWxhYmxlKCl7cmV0dXJuIHRoaXMuZmxhZ1swXS10aGlzLmlucHV0T2Zmc2V0fWNsb3NlKCl7Zm9yKDtBdG9taWNzLmNvbXBhcmVFeGNoYW5nZSh0aGlzLmZsYWcsZy5TQUJfSURYLHRoaXMuZXhwZWN0ZWQsZy5TQUJfQkFTRV9PRkZTRVQpIT09Zy5TQUJfQkFTRV9PRkZTRVQ7KTtBdG9taWNzLm5vdGlmeSh0aGlzLmZsYWcsZy5TQUJfSURYLFApfXB1bGwodD0hMCl7aWYodCl7Zm9yKDtBdG9taWNzLmNvbXBhcmVFeGNoYW5nZSh0aGlzLmZsYWcsZy5TQUJfSURYLHRoaXMuZXhwZWN0ZWQsZy5TQUJfQkFTRV9PRkZTRVQpIT09Zy5TQUJfQkFTRV9PRkZTRVQ7KTtBdG9taWNzLm5vdGlmeSh0aGlzLmZsYWcsZy5TQUJfSURYLFApfWxldCByPUF0b21pY3Mud2FpdCh0aGlzLmZsYWcsMCxnLlNBQl9CQVNFX09GRlNFVCxQKTtpZih0aGlzLmV4cGVjdGVkPUF0b21pY3MubG9hZCh0aGlzLmZsYWcsMCkscj09PSJ0aW1lZC1vdXQiKXRocm93IG5ldyBFcnJvcihgV29ya2VyIHRpbWVkIG91dCB3YWl0aW5nIGZvciByZXNwb25zZSBmcm9tIGhvc3QgYWZ0ZXIgJHtQfW1zICR7dGhpcy5mbGFnWzBdfWApO3RoaXMuaW5wdXRPZmZzZXQ9Zy5TQUJfQkFTRV9PRkZTRVR9cmVhZCh0KXtpZih0LmJ5dGVMZW5ndGg8dGhpcy5hdmFpbGFibGUpe3Quc2V0KG5ldyBVaW50OEFycmF5KHRoaXMuaW5wdXQpLnN1YmFycmF5KHRoaXMuaW5wdXRPZmZzZXQsdGhpcy5pbnB1dE9mZnNldCt0LmJ5dGVMZW5ndGgpKSx0aGlzLmlucHV0T2Zmc2V0Kz10LmJ5dGVMZW5ndGg7cmV0dXJufWxldCByPTAscz10aGlzLmF2YWlsYWJsZTtkb3tpZih0LnNldChuZXcgVWludDhBcnJheSh0aGlzLmlucHV0KS5zdWJhcnJheSh0aGlzLmlucHV0T2Zmc2V0LHRoaXMuaW5wdXRPZmZzZXQrcykscikscis9cyx0aGlzLmlucHV0T2Zmc2V0Kz1zLHI9PT10LmJ5dGVMZW5ndGh8fHRoaXMuYXZhaWxhYmxlPDApYnJlYWs7dGhpcy5wdWxsKCkscz1NYXRoLm1pbihNYXRoLm1heCh0aGlzLmF2YWlsYWJsZSwwKSx0LmJ5dGVMZW5ndGgtcil9d2hpbGUociE9PXQuYnl0ZUxlbmd0aCl9cmVhZFVpbnQ4KCl7cmV0dXJuIHRoaXMucmVhZChuZXcgVWludDhBcnJheSh0aGlzLnNjcmF0Y2gpLnN1YmFycmF5KDAsMSkpLHRoaXMuc2NyYXRjaFZpZXcuZ2V0VWludDgoMCl9cmVhZFVpbnQzMigpe3JldHVybiB0aGlzLnJlYWQobmV3IFVpbnQ4QXJyYXkodGhpcy5zY3JhdGNoKS5zdWJhcnJheSgwLDQpKSx0aGlzLnNjcmF0Y2hWaWV3LmdldFVpbnQzMigwLCEwKX1yZWFkVWludDY0KCl7cmV0dXJuIHRoaXMucmVhZChuZXcgVWludDhBcnJheSh0aGlzLnNjcmF0Y2gpKSx0aGlzLnNjcmF0Y2hWaWV3LmdldEJpZ1VpbnQ2NCgwLCEwKX1yZWFkRmxvYXQ2NCgpe3JldHVybiB0aGlzLnJlYWQobmV3IFVpbnQ4QXJyYXkodGhpcy5zY3JhdGNoKSksdGhpcy5zY3JhdGNoVmlldy5nZXRGbG9hdDY0KDAsITApfX0sST1nO0coSSwiU0FCX0lEWCIsMCksRyhJLCJTQUJfQkFTRV9PRkZTRVQiLDQpOwovLyMgc291cmNlTWFwcGluZ1VSTD13b3JrZXIuanMubWFwCg==");var se=new WeakMap,dt=class extends(window.Worker||Object){constructor(t){super(t,{type:"module",credentials:"omit",name:"extism-worker",crossOriginIsolated:!0})}on(t,e){let s=n=>e(n.data);se.set(e,s),this.addEventListener(t,s)}removeListener(t,e){let s=se.get(e);s&&this.removeEventListener(t,s)}once(t,e){let s=this;this.addEventListener(t,function n(...i){s.removeEventListener(t,n),e.call(s,...i)})}};var Ve=ze(pe(),1);var ht=r=>{if(typeof r!="string")throw new TypeError("invalid pattern");if(r.length>65536)throw new TypeError("pattern is too long")};var ns={"[:alnum:]":["\\p{L}\\p{Nl}\\p{Nd}",!0],"[:alpha:]":["\\p{L}\\p{Nl}",!0],"[:ascii:]":["\\x00-\\x7f",!1],"[:blank:]":["\\p{Zs}\\t",!0],"[:cntrl:]":["\\p{Cc}",!0],"[:digit:]":["\\p{Nd}",!0],"[:graph:]":["\\p{Z}\\p{C}",!0,!0],"[:lower:]":["\\p{Ll}",!0],"[:print:]":["\\p{C}",!0],"[:punct:]":["\\p{P}",!0],"[:space:]":["\\p{Z}\\t\\r\\n\\v\\f",!0],"[:upper:]":["\\p{Lu}",!0],"[:word:]":["\\p{L}\\p{Nl}\\p{Nd}\\p{Pc}",!0],"[:xdigit:]":["A-Fa-f0-9",!1]},mt=r=>r.replace(/[[\]\\-]/g,"\\$&"),is=r=>r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),be=r=>r.join(""),Ze=(r,t)=>{let e=t;if(r.charAt(e)!=="[")throw new Error("not in a brace expression");let s=[],n=[],i=e+1,o=!1,l=!1,a=!1,c=!1,d=e,m="";t:for(;i<r.length;){let f=r.charAt(i);if((f==="!"||f==="^")&&i===e+1){c=!0,i++;continue}if(f==="]"&&o&&!a){d=i+1;break}if(o=!0,f==="\\"&&!a){a=!0,i++;continue}if(f==="["&&!a){for(let[g,[G,w,C]]of Object.entries(ns))if(r.startsWith(g,i)){if(m)return["$.",!1,r.length-e,!0];i+=g.length,C?n.push(G):s.push(G),l=l||w;continue t}}if(a=!1,m){f>m?s.push(mt(m)+"-"+mt(f)):f===m&&s.push(mt(f)),m="",i++;continue}if(r.startsWith("-]",i+1)){s.push(mt(f+"-")),i+=2;continue}if(r.startsWith("-",i+1)){m=f,i+=2;continue}s.push(mt(f)),i++}if(d<i)return["",!1,0,!1];if(!s.length&&!n.length)return["$.",!1,r.length-e,!0];if(n.length===0&&s.length===1&&/^\\?.$/.test(s[0])&&!c){let f=s[0].length===2?s[0].slice(-1):s[0];return[is(f),!1,d-e,!1]}let u="["+(c?"^":"")+be(s)+"]",p="["+(c?"":"^")+be(n)+"]";return[s.length&&n.length?"("+u+"|"+p+")":s.length?u:p,l,d-e,!0]};var A=(r,{windowsPathsNoEscape:t=!1}={})=>t?r.replace(/\[([^\/\\])\]/g,"$1"):r.replace(/((?!\\).|^)\[([^\/\\])\]/g,"$1$2").replace(/\\([^\/])/g,"$1");var rs=new Set(["!","?","+","*","@"]),ye=r=>rs.has(r),os="(?!(?:^|/)\\.\\.?(?:$|/))",xt="(?!\\.)",ls=new Set(["[","."]),as=new Set(["..","."]),cs=new Set("().*{}+?[]^$\\!"),ds=r=>r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),zt="[^/]",Ge=zt+"*?",Xe=zt+"+?",V,I,H,X,x,P,$,v,Y,q,ft,Vt,ge,et,Wt,pt,Kt,It,Re,S=class{constructor(t,e,s={}){W(this,Vt);W(this,pt);it(this,"type");W(this,V,void 0);W(this,I,void 0);W(this,H,!1);W(this,X,[]);W(this,x,void 0);W(this,P,void 0);W(this,$,void 0);W(this,v,!1);W(this,Y,void 0);W(this,q,void 0);W(this,ft,!1);this.type=t,t&&R(this,I,!0),R(this,x,e),R(this,V,h(this,x)?h(h(this,x),V):this),R(this,Y,h(this,V)===this?s:h(h(this,V),Y)),R(this,$,h(this,V)===this?[]:h(h(this,V),$)),t==="!"&&!h(h(this,V),v)&&h(this,$).push(this),R(this,P,h(this,x)?h(h(this,x),X).length:0)}get hasMagic(){if(h(this,I)!==void 0)return h(this,I);for(let t of h(this,X))if(typeof t!="string"&&(t.type||t.hasMagic))return R(this,I,!0);return h(this,I)}toString(){return h(this,q)!==void 0?h(this,q):this.type?R(this,q,this.type+"("+h(this,X).map(t=>String(t)).join("|")+")"):R(this,q,h(this,X).map(t=>String(t)).join(""))}push(...t){for(let e of t)if(e!==""){if(typeof e!="string"&&!(e instanceof S&&h(e,x)===this))throw new Error("invalid part: "+e);h(this,X).push(e)}}toJSON(){let t=this.type===null?h(this,X).slice().map(e=>typeof e=="string"?e:e.toJSON()):[this.type,...h(this,X).map(e=>e.toJSON())];return this.isStart()&&!this.type&&t.unshift([]),this.isEnd()&&(this===h(this,V)||h(h(this,V),v)&&h(this,x)?.type==="!")&&t.push({}),t}isStart(){if(h(this,V)===this)return!0;if(!h(this,x)?.isStart())return!1;if(h(this,P)===0)return!0;let t=h(this,x);for(let e=0;e<h(this,P);e++){let s=h(t,X)[e];if(!(s instanceof S&&s.type==="!"))return!1}return!0}isEnd(){if(h(this,V)===this||h(this,x)?.type==="!")return!0;if(!h(this,x)?.isEnd())return!1;if(!this.type)return h(this,x)?.isEnd();let t=h(this,x)?h(h(this,x),X).length:0;return h(this,P)===t-1}copyIn(t){typeof t=="string"?this.push(t):this.push(t.clone(this))}clone(t){let e=new S(this.type,t);for(let s of h(this,X))e.copyIn(s);return e}static fromGlob(t,e={}){var n;let s=new S(null,void 0,e);return z(n=S,et,Wt).call(n,t,s,0,e),s}toMMPattern(){if(this!==h(this,V))return h(this,V).toMMPattern();let t=this.toString(),[e,s,n,i]=this.toRegExpSource();if(!(n||h(this,I)||h(this,Y).nocase&&!h(this,Y).nocaseMagicOnly&&t.toUpperCase()!==t.toLowerCase()))return s;let l=(h(this,Y).nocase?"i":"")+(i?"u":"");return Object.assign(new RegExp(`^${e}$`,l),{_src:e,_glob:t})}toRegExpSource(t){let e=t??!!h(this,Y).dot;if(h(this,V)===this&&z(this,Vt,ge).call(this),!this.type){let a=this.isStart()&&this.isEnd(),c=h(this,X).map(p=>{var w;let[b,f,g,G]=typeof p=="string"?z(w=S,It,Re).call(w,p,h(this,I),a):p.toRegExpSource(t);return R(this,I,h(this,I)||g),R(this,H,h(this,H)||G),b}).join(""),d="";if(this.isStart()&&typeof h(this,X)[0]=="string"&&!(h(this,X).length===1&&as.has(h(this,X)[0]))){let b=ls,f=e&&b.has(c.charAt(0))||c.startsWith("\\.")&&b.has(c.charAt(2))||c.startsWith("\\.\\.")&&b.has(c.charAt(4)),g=!e&&!t&&b.has(c.charAt(0));d=f?os:g?xt:""}let m="";return this.isEnd()&&h(h(this,V),v)&&h(this,x)?.type==="!"&&(m="(?:$|\\/)"),[d+c+m,A(c),R(this,I,!!h(this,I)),h(this,H)]}let s=this.type==="*"||this.type==="+",n=this.type==="!"?"(?:(?!(?:":"(?:",i=z(this,pt,Kt).call(this,e);if(this.isStart()&&this.isEnd()&&!i&&this.type!=="!"){let a=this.toString();return R(this,X,[a]),this.type=null,R(this,I,void 0),[a,A(this.toString()),!1,!1]}let o=!s||t||e||!xt?"":z(this,pt,Kt).call(this,!0);o===i&&(o=""),o&&(i=`(?:${i})(?:${o})*?`);let l="";if(this.type==="!"&&h(this,ft))l=(this.isStart()&&!e?xt:"")+Xe;else{let a=this.type==="!"?"))"+(this.isStart()&&!e&&!t?xt:"")+Ge+")":this.type==="@"?")":this.type==="?"?")?":this.type==="+"&&o?")":this.type==="*"&&o?")?":`)${this.type}`;l=n+i+a}return[l,A(i),R(this,I,!!h(this,I)),h(this,H)]}},U=S;V=new WeakMap,I=new WeakMap,H=new WeakMap,X=new WeakMap,x=new WeakMap,P=new WeakMap,$=new WeakMap,v=new WeakMap,Y=new WeakMap,q=new WeakMap,ft=new WeakMap,Vt=new WeakSet,ge=function(){if(this!==h(this,V))throw new Error("should only call on root");if(h(this,v))return this;this.toString(),R(this,v,!0);let t;for(;t=h(this,$).pop();){if(t.type!=="!")continue;let e=t,s=h(e,x);for(;s;){for(let n=h(e,P)+1;!s.type&&n<h(s,X).length;n++)for(let i of h(t,X)){if(typeof i=="string")throw new Error("string part in extglob AST??");i.copyIn(h(s,X)[n])}e=s,s=h(e,x)}}return this},et=new WeakSet,Wt=function(t,e,s,n){var p,b;let i=!1,o=!1,l=-1,a=!1;if(e.type===null){let f=s,g="";for(;f<t.length;){let G=t.charAt(f++);if(i||G==="\\"){i=!i,g+=G;continue}if(o){f===l+1?(G==="^"||G==="!")&&(a=!0):G==="]"&&!(f===l+2&&a)&&(o=!1),g+=G;continue}else if(G==="["){o=!0,l=f,a=!1,g+=G;continue}if(!n.noext&&ye(G)&&t.charAt(f)==="("){e.push(g),g="";let w=new S(G,e);f=z(p=S,et,Wt).call(p,t,w,f,n),e.push(w);continue}g+=G}return e.push(g),f}let c=s+1,d=new S(null,e),m=[],u="";for(;c<t.length;){let f=t.charAt(c++);if(i||f==="\\"){i=!i,u+=f;continue}if(o){c===l+1?(f==="^"||f==="!")&&(a=!0):f==="]"&&!(c===l+2&&a)&&(o=!1),u+=f;continue}else if(f==="["){o=!0,l=c,a=!1,u+=f;continue}if(ye(f)&&t.charAt(c)==="("){d.push(u),u="";let g=new S(f,d);d.push(g),c=z(b=S,et,Wt).call(b,t,g,c,n);continue}if(f==="|"){d.push(u),u="",m.push(d),d=new S(null,e);continue}if(f===")")return u===""&&h(e,X).length===0&&R(e,ft,!0),d.push(u),u="",e.push(...m,d),c;u+=f}return e.type=null,R(e,I,void 0),R(e,X,[t.substring(s-1)]),c},pt=new WeakSet,Kt=function(t){return h(this,X).map(e=>{if(typeof e=="string")throw new Error("string type in extglob ast??");let[s,n,i,o]=e.toRegExpSource(t);return R(this,H,h(this,H)||o),s}).filter(e=>!(this.isStart()&&this.isEnd())||!!e).join("|")},It=new WeakSet,Re=function(t,e,s=!1){let n=!1,i="",o=!1;for(let l=0;l<t.length;l++){let a=t.charAt(l);if(n){n=!1,i+=(cs.has(a)?"\\":"")+a;continue}if(a==="\\"){l===t.length-1?i+="\\\\":n=!0;continue}if(a==="["){let[c,d,m,u]=Ze(t,l);if(m){i+=c,o=o||d,l+=m-1,e=e||u;continue}}if(a==="*"){s&&t==="*"?i+=Xe:i+=Ge,e=!0;continue}if(a==="?"){i+=zt,e=!0;continue}i+=ds(a)}return[i,A(t),!!e,o]},W(U,et),W(U,It);var Mt=(r,{windowsPathsNoEscape:t=!1}={})=>t?r.replace(/[?*()[\]]/g,"[$&]"):r.replace(/[?*()[\]\\]/g,"\\$&");var L=(r,t,e={})=>(ht(t),!e.nocomment&&t.charAt(0)==="#"?!1:new st(t,e).match(r)),us=/^\*+([^+@!?\*\[\(]*)$/,hs=r=>t=>!t.startsWith(".")&&t.endsWith(r),ms=r=>t=>t.endsWith(r),fs=r=>(r=r.toLowerCase(),t=>!t.startsWith(".")&&t.toLowerCase().endsWith(r)),ps=r=>(r=r.toLowerCase(),t=>t.toLowerCase().endsWith(r)),bs=/^\*+\.\*+$/,Zs=r=>!r.startsWith(".")&&r.includes("."),ys=r=>r!=="."&&r!==".."&&r.includes("."),Gs=/^\.\*+$/,Xs=r=>r!=="."&&r!==".."&&r.startsWith("."),gs=/^\*+$/,Rs=r=>r.length!==0&&!r.startsWith("."),xs=r=>r.length!==0&&r!=="."&&r!=="..",Ws=/^\?+([^+@!?\*\[\(]*)?$/,Vs=([r,t=""])=>{let e=Ie([r]);return t?(t=t.toLowerCase(),s=>e(s)&&s.toLowerCase().endsWith(t)):e},Is=([r,t=""])=>{let e=Le([r]);return t?(t=t.toLowerCase(),s=>e(s)&&s.toLowerCase().endsWith(t)):e},Ls=([r,t=""])=>{let e=Le([r]);return t?s=>e(s)&&s.endsWith(t):e},ws=([r,t=""])=>{let e=Ie([r]);return t?s=>e(s)&&s.endsWith(t):e},Ie=([r])=>{let t=r.length;return e=>e.length===t&&!e.startsWith(".")},Le=([r])=>{let t=r.length;return e=>e.length===t&&e!=="."&&e!==".."},we=typeof process=="object"&&process?typeof process.env=="object"&&process.env&&process.env.__MINIMATCH_TESTING_PLATFORM__||process.platform:"posix",xe={win32:{sep:"\\"},posix:{sep:"/"}},Ss=we==="win32"?xe.win32.sep:xe.posix.sep;L.sep=Ss;var E=Symbol("globstar **");L.GLOBSTAR=E;var Ns="[^/]",_s=Ns+"*?",Es="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",Ts="(?:(?!(?:\\/|^)\\.).)*?",Cs=(r,t={})=>e=>L(e,r,t);L.filter=Cs;var _=(r,t={})=>Object.assign({},r,t),Fs=r=>{if(!r||typeof r!="object"||!Object.keys(r).length)return L;let t=L;return Object.assign((s,n,i={})=>t(s,n,_(r,i)),{Minimatch:class extends t.Minimatch{constructor(n,i={}){super(n,_(r,i))}static defaults(n){return t.defaults(_(r,n)).Minimatch}},AST:class extends t.AST{constructor(n,i,o={}){super(n,i,_(r,o))}static fromGlob(n,i={}){return t.AST.fromGlob(n,_(r,i))}},unescape:(s,n={})=>t.unescape(s,_(r,n)),escape:(s,n={})=>t.escape(s,_(r,n)),filter:(s,n={})=>t.filter(s,_(r,n)),defaults:s=>t.defaults(_(r,s)),makeRe:(s,n={})=>t.makeRe(s,_(r,n)),braceExpand:(s,n={})=>t.braceExpand(s,_(r,n)),match:(s,n,i={})=>t.match(s,n,_(r,i)),sep:t.sep,GLOBSTAR:E})};L.defaults=Fs;var Se=(r,t={})=>(ht(r),t.nobrace||!/\{(?:(?!\{).)*\}/.test(r)?[r]:(0,Ve.default)(r));L.braceExpand=Se;var Hs=(r,t={})=>new st(r,t).makeRe();L.makeRe=Hs;var Ys=(r,t,e={})=>{let s=new st(t,e);return r=r.filter(n=>s.match(n)),s.options.nonull&&!r.length&&r.push(t),r};L.match=Ys;var We=/[?*]|[+@!]\(.*?\)|\[|\]/,ks=r=>r.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),st=class{options;set;pattern;windowsPathsNoEscape;nonegate;negate;comment;empty;preserveMultipleSlashes;partial;globSet;globParts;nocase;isWindows;platform;windowsNoMagicRoot;regexp;constructor(t,e={}){ht(t),e=e||{},this.options=e,this.pattern=t,this.platform=e.platform||we,this.isWindows=this.platform==="win32",this.windowsPathsNoEscape=!!e.windowsPathsNoEscape||e.allowWindowsEscape===!1,this.windowsPathsNoEscape&&(this.pattern=this.pattern.replace(/\\/g,"/")),this.preserveMultipleSlashes=!!e.preserveMultipleSlashes,this.regexp=null,this.negate=!1,this.nonegate=!!e.nonegate,this.comment=!1,this.empty=!1,this.partial=!!e.partial,this.nocase=!!this.options.nocase,this.windowsNoMagicRoot=e.windowsNoMagicRoot!==void 0?e.windowsNoMagicRoot:!!(this.isWindows&&this.nocase),this.globSet=[],this.globParts=[],this.set=[],this.make()}hasMagic(){if(this.options.magicalBraces&&this.set.length>1)return!0;for(let t of this.set)for(let e of t)if(typeof e!="string")return!0;return!1}debug(...t){}make(){let t=this.pattern,e=this.options;if(!e.nocomment&&t.charAt(0)==="#"){this.comment=!0;return}if(!t){this.empty=!0;return}this.parseNegate(),this.globSet=[...new Set(this.braceExpand())],e.debug&&(this.debug=(...i)=>console.error(...i)),this.debug(this.pattern,this.globSet);let s=this.globSet.map(i=>this.slashSplit(i));this.globParts=this.preprocess(s),this.debug(this.pattern,this.globParts);let n=this.globParts.map((i,o,l)=>{if(this.isWindows&&this.windowsNoMagicRoot){let a=i[0]===""&&i[1]===""&&(i[2]==="?"||!We.test(i[2]))&&!We.test(i[3]),c=/^[a-z]:/i.test(i[0]);if(a)return[...i.slice(0,4),...i.slice(4).map(d=>this.parse(d))];if(c)return[i[0],...i.slice(1).map(d=>this.parse(d))]}return i.map(a=>this.parse(a))});if(this.debug(this.pattern,n),this.set=n.filter(i=>i.indexOf(!1)===-1),this.isWindows)for(let i=0;i<this.set.length;i++){let o=this.set[i];o[0]===""&&o[1]===""&&this.globParts[i][2]==="?"&&typeof o[3]=="string"&&/^[a-z]:$/i.test(o[3])&&(o[2]="?")}this.debug(this.pattern,this.set)}preprocess(t){if(this.options.noglobstar)for(let s=0;s<t.length;s++)for(let n=0;n<t[s].length;n++)t[s][n]==="**"&&(t[s][n]="*");let{optimizationLevel:e=1}=this.options;return e>=2?(t=this.firstPhasePreProcess(t),t=this.secondPhasePreProcess(t)):e>=1?t=this.levelOneOptimize(t):t=this.adjascentGlobstarOptimize(t),t}adjascentGlobstarOptimize(t){return t.map(e=>{let s=-1;for(;(s=e.indexOf("**",s+1))!==-1;){let n=s;for(;e[n+1]==="**";)n++;n!==s&&e.splice(s,n-s)}return e})}levelOneOptimize(t){return t.map(e=>(e=e.reduce((s,n)=>{let i=s[s.length-1];return n==="**"&&i==="**"?s:n===".."&&i&&i!==".."&&i!=="."&&i!=="**"?(s.pop(),s):(s.push(n),s)},[]),e.length===0?[""]:e))}levelTwoFileOptimize(t){Array.isArray(t)||(t=this.slashSplit(t));let e=!1;do{if(e=!1,!this.preserveMultipleSlashes){for(let n=1;n<t.length-1;n++){let i=t[n];n===1&&i===""&&t[0]===""||(i==="."||i==="")&&(e=!0,t.splice(n,1),n--)}t[0]==="."&&t.length===2&&(t[1]==="."||t[1]==="")&&(e=!0,t.pop())}let s=0;for(;(s=t.indexOf("..",s+1))!==-1;){let n=t[s-1];n&&n!=="."&&n!==".."&&n!=="**"&&(e=!0,t.splice(s-1,2),s-=2)}}while(e);return t.length===0?[""]:t}firstPhasePreProcess(t){let e=!1;do{e=!1;for(let s of t){let n=-1;for(;(n=s.indexOf("**",n+1))!==-1;){let o=n;for(;s[o+1]==="**";)o++;o>n&&s.splice(n+1,o-n);let l=s[n+1],a=s[n+2],c=s[n+3];if(l!==".."||!a||a==="."||a===".."||!c||c==="."||c==="..")continue;e=!0,s.splice(n,1);let d=s.slice(0);d[n]="**",t.push(d),n--}if(!this.preserveMultipleSlashes){for(let o=1;o<s.length-1;o++){let l=s[o];o===1&&l===""&&s[0]===""||(l==="."||l==="")&&(e=!0,s.splice(o,1),o--)}s[0]==="."&&s.length===2&&(s[1]==="."||s[1]==="")&&(e=!0,s.pop())}let i=0;for(;(i=s.indexOf("..",i+1))!==-1;){let o=s[i-1];if(o&&o!=="."&&o!==".."&&o!=="**"){e=!0;let a=i===1&&s[i+1]==="**"?["."]:[];s.splice(i-1,2,...a),s.length===0&&s.push(""),i-=2}}}}while(e);return t}secondPhasePreProcess(t){for(let e=0;e<t.length-1;e++)for(let s=e+1;s<t.length;s++){let n=this.partsMatch(t[e],t[s],!this.preserveMultipleSlashes);!n||(t[e]=n,t[s]=[])}return t.filter(e=>e.length)}partsMatch(t,e,s=!1){let n=0,i=0,o=[],l="";for(;n<t.length&&i<e.length;)if(t[n]===e[i])o.push(l==="b"?e[i]:t[n]),n++,i++;else if(s&&t[n]==="**"&&e[i]===t[n+1])o.push(t[n]),n++;else if(s&&e[i]==="**"&&t[n]===e[i+1])o.push(e[i]),i++;else if(t[n]==="*"&&e[i]&&(this.options.dot||!e[i].startsWith("."))&&e[i]!=="**"){if(l==="b")return!1;l="a",o.push(t[n]),n++,i++}else if(e[i]==="*"&&t[n]&&(this.options.dot||!t[n].startsWith("."))&&t[n]!=="**"){if(l==="a")return!1;l="b",o.push(e[i]),n++,i++}else return!1;return t.length===e.length&&o}parseNegate(){if(this.nonegate)return;let t=this.pattern,e=!1,s=0;for(let n=0;n<t.length&&t.charAt(n)==="!";n++)e=!e,s++;s&&(this.pattern=t.slice(s)),this.negate=e}matchOne(t,e,s=!1){let n=this.options;if(this.isWindows){let f=typeof t[0]=="string"&&/^[a-z]:$/i.test(t[0]),g=!f&&t[0]===""&&t[1]===""&&t[2]==="?"&&/^[a-z]:$/i.test(t[3]),G=typeof e[0]=="string"&&/^[a-z]:$/i.test(e[0]),w=!G&&e[0]===""&&e[1]===""&&e[2]==="?"&&typeof e[3]=="string"&&/^[a-z]:$/i.test(e[3]),C=g?3:f?0:void 0,k=w?3:G?0:void 0;if(typeof C=="number"&&typeof k=="number"){let[K,N]=[t[C],e[k]];K.toLowerCase()===N.toLowerCase()&&(e[k]=K,k>C?e=e.slice(k):C>k&&(t=t.slice(C)))}}let{optimizationLevel:i=1}=this.options;i>=2&&(t=this.levelTwoFileOptimize(t)),this.debug("matchOne",this,{file:t,pattern:e}),this.debug("matchOne",t.length,e.length);for(var o=0,l=0,a=t.length,c=e.length;o<a&&l<c;o++,l++){this.debug("matchOne loop");var d=e[l],m=t[o];if(this.debug(e,d,m),d===!1)return!1;if(d===E){this.debug("GLOBSTAR",[e,d,m]);var u=o,p=l+1;if(p===c){for(this.debug("** at the end");o<a;o++)if(t[o]==="."||t[o]===".."||!n.dot&&t[o].charAt(0)===".")return!1;return!0}for(;u<a;){var b=t[u];if(this.debug(`
globstar while`,t,u,e,p,b),this.matchOne(t.slice(u),e.slice(p),s))return this.debug("globstar found match!",u,a,b),!0;if(b==="."||b===".."||!n.dot&&b.charAt(0)==="."){this.debug("dot detected!",t,u,e,p);break}this.debug("globstar swallow a segment, and continue"),u++}return!!(s&&(this.debug(`
>>> no match, partial?`,t,u,e,p),u===a))}let f;if(typeof d=="string"?(f=m===d,this.debug("string match",d,m,f)):(f=d.test(m),this.debug("pattern match",d,m,f)),!f)return!1}if(o===a&&l===c)return!0;if(o===a)return s;if(l===c)return o===a-1&&t[o]==="";throw new Error("wtf?")}braceExpand(){return Se(this.pattern,this.options)}parse(t){ht(t);let e=this.options;if(t==="**")return E;if(t==="")return"";let s,n=null;(s=t.match(gs))?n=e.dot?xs:Rs:(s=t.match(us))?n=(e.nocase?e.dot?ps:fs:e.dot?ms:hs)(s[1]):(s=t.match(Ws))?n=(e.nocase?e.dot?Is:Vs:e.dot?Ls:ws)(s):(s=t.match(bs))?n=e.dot?ys:Zs:(s=t.match(Gs))&&(n=Xs);let i=U.fromGlob(t,this.options).toMMPattern();return n?Object.assign(i,{test:n}):i}makeRe(){if(this.regexp||this.regexp===!1)return this.regexp;let t=this.set;if(!t.length)return this.regexp=!1,this.regexp;let e=this.options,s=e.noglobstar?_s:e.dot?Es:Ts,n=new Set(e.nocase?["i"]:[]),i=t.map(a=>{let c=a.map(d=>{if(d instanceof RegExp)for(let m of d.flags.split(""))n.add(m);return typeof d=="string"?ks(d):d===E?E:d._src});return c.forEach((d,m)=>{let u=c[m+1],p=c[m-1];d!==E||p===E||(p===void 0?u!==void 0&&u!==E?c[m+1]="(?:\\/|"+s+"\\/)?"+u:c[m]=s:u===void 0?c[m-1]=p+"(?:\\/|"+s+")?":u!==E&&(c[m-1]=p+"(?:\\/|\\/"+s+"\\/)"+u,c[m+1]=E))}),c.filter(d=>d!==E).join("/")}).join("|"),[o,l]=t.length>1?["(?:",")"]:["",""];i="^"+o+i+l+"$",this.negate&&(i="^(?!"+i+").+$");try{this.regexp=new RegExp(i,[...n].join(""))}catch{this.regexp=!1}return this.regexp}slashSplit(t){return this.preserveMultipleSlashes?t.split("/"):this.isWindows&&/^\/\/[^\/]+/.test(t)?["",...t.split(/\/+/)]:t.split(/\/+/)}match(t,e=this.partial){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return t==="";if(t==="/"&&e)return!0;let s=this.options;this.isWindows&&(t=t.split("\\").join("/"));let n=this.slashSplit(t);this.debug(this.pattern,"split",n);let i=this.set;this.debug(this.pattern,"set",i);let o=n[n.length-1];if(!o)for(let l=n.length-2;!o&&l>=0;l--)o=n[l];for(let l=0;l<i.length;l++){let a=i[l],c=n;if(s.matchBase&&a.length===1&&(c=[o]),this.matchOne(c,a,e))return s.flipNegate?!0:!this.negate}return s.flipNegate?!1:this.negate}static defaults(t){return L.defaults(t).Minimatch}};L.AST=U;L.Minimatch=st;L.escape=Mt;L.unescape=A;function Ne(r,t){return L(r,t)}var Ks=5e3;var zs=Atomics.waitAsync||(()=>{let r=`onmessage = ev => {
    const [b, i, v] = ev.data
    const f = new Int32Array(b)
    postMessage(Atomics.wait(f, i, v));
  }`,t=new Blob([r],{type:"text/javascript"}),e=URL.createObjectURL(t),s=new dt(e);return(n,i,o)=>{let l=new Promise(a=>{s.once("message",c=>{a(c)})});return s.postMessage([n.buffer,i,o]),{async:!0,value:l}}})(),Ot=class{worker;sharedData;sharedDataView;hostFlag;opts;#e;#t=null;constructor(t,e,s,n){this.worker=t,this.sharedData=e,this.sharedDataView=new DataView(e),this.hostFlag=new Int32Array(e),this.opts=s,this.#e=n,this.hostFlag[0]=nt.SAB_BASE_OFFSET,this.worker.on("message",i=>this.#s(i))}async reset(){return this.isActive()?!1:(await this.#i("reset"),this.#e[lt](),!0)}isActive(){return Boolean(this.#t)}async#s(t){switch(t?.type){case"invoke":return this.#o(t);case"return":return this.#l(t);case"log":return this.#n(t)}}#n(t){let e=this.opts.logger[t.level];typeof e!="function"?this.opts.logger?.error(`failed to find loglevel="${t.level}" on logger: message=${t.message}`):e.call(this.opts.logger,t.message)}#l(t){let e=this.#t||null;if(e===null)throw new Error('received "return" call with no corresponding request');this.#t=null;let[s,n]=e;if(!Array.isArray(t.results)||t.results.length!==2)return n(new Error('received malformed "return"'));let[i,o]=t.results;i?n(i):s(o)}async#i(t,...e){if(this.#t)throw new Error("plugin is not reentrant");let s,n,i=new Promise((o,l)=>{s=o,n=l});return this.#t=[s,n],this.worker.postMessage({type:"invoke",handler:t,args:e}),i}async functionExists(t){return await this.#i("functionExists",t)}async call(t,e){let s=this.#e[Q](e),[n,i]=await this.callBlock(t,s),o=n!==null,l=n??i;if(l===null)return null;let a=this.#e[ot](l);if(a===null)return null;let c=new F(M.allowSharedBufferCodec?a.buffer:new Uint8Array(a.buffer).slice().buffer);if(o){let d=new TextDecoder().decode(c);throw new Error(`Plugin-originated error: ${d}`)}return c}async callBlock(t,e){let s=this.#e[Gt](),{results:n,state:i}=await this.#i("call",t,e,s);this.#e[yt](i,!0);let[o,l]=n;if(o)throw o;return l}async#o(t){let e=new nt(this.sharedData),n=(this.opts.functions[t.namespace]??{})[t.func];try{if(!n)throw Error(`Plugin error: host function "${t.namespace}" "${t.func}" does not exist`);this.#e[yt](t.state,!0);let i=await n(this.#e,...t.args),{blocks:o}=this.#e[Gt](),l;for(let[a,c]of o)l=e.writeUint8(4),l&&await l,l=e.writeUint32(c),l&&await l,l=e.writeUint32(a?.byteLength||0),l&&await l,a&&(l=e.write(a),l&&await l);typeof i=="bigint"?(l=e.writeUint8(1),l&&await l,l=e.writeUint64(i),l&&await l):typeof i=="number"?(l=e.writeUint8(2),l&&await l,l=e.writeFloat64(i),l&&await l):(l=e.writeUint8(3),l&&await l),l=e.writeUint8(0),l&&await l,await e.flush()}catch(i){this.close();let[,o]=this.#t;return this.#t=null,o(i)}}async getExports(t){return await this.#i("getExports",t??"0")}async getImports(t){return await this.#i("getImports",t??"0")}async getInstance(){throw new Error("todo")}async close(){this.worker&&(this.worker.terminate(),this.worker=null)}},Bt=class{fetch;lastStatusCode;allowedHosts;constructor(t,e){this.fetch=t,this.allowedHosts=e,this.lastStatusCode=0}contribute(t){t[ct]??={},t[ct].http_request=(e,s,n)=>this.makeRequest(e,s,n),t[ct].http_status_code=()=>this.lastStatusCode}async makeRequest(t,e,s){let n=t.read(e);if(n===null)return 0n;let{header:i,url:o,method:l}=n.json(),a=l??"GET",c=new URL(o);if(!this.allowedHosts.some(f=>f===c.hostname||Ne(c.hostname,f)))throw new Error(`Call error: HTTP request to "${c}" is not allowed (no allowedHosts match "${c.hostname}")`);let m=s===0n||a==="GET"||a==="HEAD"?null:t.read(s)?.bytes(),u=this.fetch,p=await u(o,{headers:i,method:a,...m?{body:m.slice()}:{}});return this.lastStatusCode=p.status,t.store(new Uint8Array(await p.arrayBuffer()))}};async function _e(r,t,e){let s=new dt(ee),n=new tt(SharedArrayBuffer,r.logger,r.config);new Bt(r.fetch,r.allowedHosts).contribute(r.functions),await new Promise((u,p)=>{s.on("message",function b(f){f?.type!=="initialized"&&p(new Error(`received unexpected message (type=${f?.type})`)),s.removeListener("message",b),u(null)})});let o=new SharedArrayBuffer(r.sharedArrayBufferSize),{fetch:l,logger:a,...c}=r,d={...c,type:"init",functions:Object.fromEntries(Object.entries(r.functions||{}).map(([u,p])=>[u,Object.keys(p)])),names:t,modules:e,sharedData:o},m=new Promise((u,p)=>{s.on("message",function b(f){f?.type!=="ready"&&p(new Error(`received unexpected message (type=${f?.type})`)),s.removeListener("message",b),u(null)})});return s.postMessage(d),await m,new Ot(s,o,r,n)}var T=class{output;scratch;scratchView;outputOffset;flag;constructor(t){this.scratch=new ArrayBuffer(8),this.scratchView=new DataView(this.scratch),this.output=t,this.outputOffset=T.SAB_BASE_OFFSET,this.flag=new Int32Array(this.output)}async flush(){if(this.outputOffset===T.SAB_BASE_OFFSET)return;let t=this.outputOffset;for(this.outputOffset=T.SAB_BASE_OFFSET;Atomics.compareExchange(this.flag,T.SAB_IDX,T.SAB_BASE_OFFSET,t)!==t;);Atomics.notify(this.flag,T.SAB_IDX,1);let e=zs(this.flag,T.SAB_IDX,t,Ks),s;try{s=setInterval(()=>{},0),e.async&&(e.value=await e.value)}finally{clearInterval(s)}if(e.value==="timed-out")throw new Error(`encountered timeout while flushing host function to worker memory ${this.flag[0]}`)}async spanningWrite(t){let e=0,s=this.output.byteLength-this.outputOffset,n=1+Math.floor((t.byteLength-s)/(this.output.byteLength-T.SAB_BASE_OFFSET)),i=(t.byteLength-s)%(this.output.byteLength-T.SAB_BASE_OFFSET);do new Uint8Array(this.output).set(t.subarray(e,e+s),this.outputOffset),this.outputOffset+=s,e+=s,await this.flush(),s=this.output.byteLength-T.SAB_BASE_OFFSET,--n;while(n!=0);i&&this.write(t.subarray(e,e+i))}write(t){if(t.byteLength+this.outputOffset<this.output.byteLength){new Uint8Array(this.output).set(new Uint8Array(t),this.outputOffset),this.outputOffset+=t.byteLength;return}return this.spanningWrite(new Uint8Array(t))}writeUint8(t){return this.scratchView.setUint8(0,t),this.write(this.scratch.slice(0,1))}writeUint32(t){return this.scratchView.setUint32(0,t,!0),this.write(this.scratch.slice(0,4))}writeUint64(t){return this.scratchView.setBigUint64(0,t,!0),this.write(this.scratch.slice(0,8))}writeFloat64(t){return this.scratchView.setFloat64(0,t,!0),this.write(this.scratch.slice(0,8))}},nt=T;it(nt,"SAB_IDX",0),it(nt,"SAB_BASE_OFFSET",4);async function Ms(r,t={}){if(t={...t},t.useWasi??=!1,t.functions=t.functions||{},t.allowedPaths??={},t.allowedHosts??=[].concat(t.allowedHosts||[]),t.logger??=console,t.config??={},t.fetch??=fetch,t.runInWorker??=M.hasWorkerCapability,t.runInWorker&&!M.hasWorkerCapability)throw new Error("Cannot enable off-thread wasm; current context is not `crossOriginIsolated` (see https://mdn.io/crossOriginIsolated)");let[e,s]=await Ut(await Promise.resolve(r),t.fetch??fetch),n={allowedHosts:t.allowedHosts,allowedPaths:t.allowedPaths,functions:t.functions,fetch:t.fetch||fetch,wasiEnabled:t.useWasi,logger:t.logger,config:t.config,sharedArrayBufferSize:Number(t.sharedArrayBufferSize)||1<<16};return(t.runInWorker?_e:te)(n,e,s)}var Li=Ms;export{M as CAPABILITIES,Ms as createPlugin,Li as default,Ms as newPlugin};
//# sourceMappingURL=mod.js.map
